<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>vue3上手指南 | Mr.储</title><meta name="keywords" content="web前端"><meta name="author" content="Mr.储"><meta name="copyright" content="Mr.储"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="了解 Vue3 官方文档: https:&#x2F;&#x2F;staging-cn.vuejs.org  1. 了解相关信息 2年多开发, 100+位贡献者, 2600+次提交, 600+次PR(Pulll Request) Vue3支持vue2的大多数特性 更好的支持Typescript  2. 性能提升 打包大小减少41% 初次渲染快55%, 更新渲染快133% 内存减少54% 重写虚拟DOM的实现和Tree-">
<meta property="og:type" content="article">
<meta property="og:title" content="vue3上手指南">
<meta property="og:url" content="https://old-gang.github.io/post/bc05aa0f.html">
<meta property="og:site_name" content="Mr.储">
<meta property="og:description" content="了解 Vue3 官方文档: https:&#x2F;&#x2F;staging-cn.vuejs.org  1. 了解相关信息 2年多开发, 100+位贡献者, 2600+次提交, 600+次PR(Pulll Request) Vue3支持vue2的大多数特性 更好的支持Typescript  2. 性能提升 打包大小减少41% 初次渲染快55%, 更新渲染快133% 内存减少54% 重写虚拟DOM的实现和Tree-">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-10-13T10:39:43.000Z">
<meta property="article:modified_time" content="2024-05-02T07:13:42.494Z">
<meta property="article:author" content="Mr.储">
<meta property="article:tag" content="web前端">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://old-gang.github.io/post/bc05aa0f"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vue3上手指南',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-02 15:13:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Mr.储</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">vue3上手指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2024-05-02T07:13:42.494Z" title="更新于 2024-05-02 15:13:42">2024-05-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="vue3上手指南"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="了解-Vue3"><a href="#了解-Vue3" class="headerlink" title="了解 Vue3"></a>了解 Vue3</h2><blockquote>
<p>官方文档: <a target="_blank" rel="noopener" href="https://staging-cn.vuejs.org/">https://staging-cn.vuejs.org</a></p>
</blockquote>
<h3 id="1-了解相关信息"><a href="#1-了解相关信息" class="headerlink" title="1. 了解相关信息"></a>1. 了解相关信息</h3><ul>
<li>2年多开发, 100+位贡献者, 2600+次提交, 600+次PR(Pulll Request)</li>
<li>Vue3支持vue2的大多数特性</li>
<li>更好的支持Typescript</li>
</ul>
<h3 id="2-性能提升"><a href="#2-性能提升" class="headerlink" title="2. 性能提升"></a>2. 性能提升</h3><ul>
<li>打包大小减少41%</li>
<li>初次渲染快55%, 更新渲染快133%</li>
<li>内存减少54%</li>
<li>重写虚拟DOM的实现和Tree-Shaking</li>
</ul>
<h3 id="3-Composition-API"><a href="#3-Composition-API" class="headerlink" title="3. Composition API"></a>3. Composition API</h3><ul>
<li>也称组合 API</li>
<li>setup</li>
<li>ref 和 reactive</li>
<li>computed 和 watch</li>
<li>新的生命周期函数</li>
<li>自定义hooks函数</li>
</ul>
<h3 id="4-其它新增特性"><a href="#4-其它新增特性" class="headerlink" title="4. 其它新增特性"></a>4. 其它新增特性</h3><ul>
<li>Teleport - 瞬移组件的位置</li>
<li>Suspense - 异步加载组件的loading界面</li>
<li>全局API的修改</li>
</ul>
<h2 id="创建vue3项目"><a href="#创建vue3项目" class="headerlink" title="创建vue3项目"></a>创建vue3项目</h2><h3 id="1-使用-vue-cli-创建"><a href="#1-使用-vue-cli-创建" class="headerlink" title="1. 使用 vue-cli 创建"></a>1. 使用 vue-cli 创建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装或者升级</span></span><br><span class="line">npm install -g @vue/cli   --- 最好是在cmd中执行---system32/cmd---开始---cmd</span><br><span class="line"><span class="comment">## 保证 vue cli 版本在 4.5.0 以上</span></span><br><span class="line">vue --version</span><br><span class="line"><span class="comment">## 创建项目</span></span><br><span class="line">vue create &lt;project-name&gt;</span><br><span class="line"></span><br><span class="line">vue.config.json文件可以配置</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    port:8000,</span><br><span class="line">    open:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>然后的步骤</p>
<ul>
<li>Please pick a preset - 选择 <strong>Manually select features</strong></li>
<li>Check the features needed for your project - 多选择上 <strong>TypeScript</strong> &amp;&amp;  <strong>Router</strong> &amp;&amp;  <strong>Vuex</strong>，特别注意点空格是选择，点回车是下一步</li>
<li>Choose a version of Vue.js that you want to start the project with - 选择 <strong>3.x (Preview)</strong></li>
<li>Use class-style component syntax - 直接回车</li>
<li>Use Babel alongside TypeScript - 直接回车</li>
<li>Pick a linter &#x2F; formatter config - 直接回车</li>
<li>Use history mode for router? - 直接回车</li>
<li>Pick a linter &#x2F; formatter config - 直接回车</li>
<li>Pick additional lint features - 直接回车</li>
<li>Where do you prefer placing config for Babel, ESLint, etc.? - 直接回车</li>
<li>Save this as a preset for future projects? - 直接回车</li>
</ul>
<h3 id="2-使用-vite-创建"><a href="#2-使用-vite-创建" class="headerlink" title="2. 使用 vite 创建"></a>2. 使用 vite 创建</h3><p>Vite 是一个由原生 ESM 驱动的 Web 开发构建工具。在开发环境下基于浏览器原生 ES imports 开发，在生产环境下基于 Rollup 打包。相比较webpack打包环境, 启动快很多,文档:<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/">https://cn.vitejs.dev/</a></p>
<ul>
<li>快速的冷启动，不需要等待打包操作；</li>
<li>即时的热模块更新，替换性能和模块数量的解耦让更新飞起；</li>
<li>真正的按需编译，不再等待整个应用编译完成，这是一个巨大的改变。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">兼容性注意</span><br><span class="line">Vite 需要 Node.js 版本 &gt;= 14.18.0。然而，有些模板需要依赖更高的 Node 版本才能正常运行，当你的包管理器发出警告时，请注意升级你的 Node 版本。</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用npm</span></span><br><span class="line">npm create vite@latest 项目名称</span><br><span class="line"><span class="comment">## 使用yarn</span></span><br><span class="line">yarn create vite</span><br><span class="line"><span class="comment">## 创建项目</span></span><br><span class="line">npm init vite-app &lt;project-name&gt; 老版本</span><br><span class="line"><span class="built_in">cd</span> &lt;project-name&gt;</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># npm 6.x的方式</span></span><br><span class="line">npm create vite@latest my-vue-app --template vue</span><br><span class="line"><span class="comment"># npm 7+的方式, extra double-dash is needed:</span></span><br><span class="line">npm create vite@latest my-vue-app -- --template vue</span><br></pre></td></tr></table></figure>



<p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/image-20220705112829318.png"></p>
<h2 id="初识Vue3"><a href="#初识Vue3" class="headerlink" title="初识Vue3"></a>初识Vue3</h2><h3 id="1-源码分析"><a href="#1-源码分析" class="headerlink" title="1.源码分析"></a>1.源码分析</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;msg&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;&#123;&#123;showMsg()&#125;&#125;&lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">/*</span><br><span class="line">v3.x中组件内部的结构里是可以没有根标签,因此,可以看出,渲染速度肯定/一定/必须地比v2.x的页面渲染速度快,效率高,提升了体验,很舒服</span><br><span class="line">v3.x语法中,html标签并不需要那么严谨(并不是好事)</span><br><span class="line">v3.x支持ts语法</span><br><span class="line">v3.x支持v2.x语法</span><br><span class="line">defineComponent是一个函数,一般情况传入的是一个选项配置对象(vue2.x中的组件文件中的 组件对象),返回的就是该组件对象,可以直接当成组件使用</span><br><span class="line">*/</span><br><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">     return &#123;</span><br><span class="line">       msg:&#x27;冰激淋离开了冰箱,越走越远,后来化了,后悔了,于是掉头回来找到了冰箱,并且认错&#x27;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   methods:&#123;</span><br><span class="line">     showMsg()&#123;</span><br><span class="line">       console.log(&#x27;冰箱原谅说:上来吧,自己冻&#x27;)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="Composition-API使用"><a href="#Composition-API使用" class="headerlink" title="Composition API使用"></a>Composition API使用</h2><h3 id="1-setup"><a href="#1-setup" class="headerlink" title="1. setup"></a>1. setup</h3><p><code>setup</code> 函数是一个新的组件选项。作为在组件内使用 Composition API 的入口点。</p>
<p>创建组件实例，然后初始化 <code>props</code> ，紧接着就调用<code>setup</code> 函数。从生命周期钩子的视角来看，它会在 <code>beforeCreate</code> 钩子之前被调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h3&gt;&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;&#123;&#123;showMsg()&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;changeCount&quot;&gt;测试&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  beforeCreate () &#123; // 生命周期钩子</span><br><span class="line">    console.log(&#x27;beforeCreate()&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // 函数如果返回对象, 对象中的属性或方法, 模板中可以直接使用</span><br><span class="line">  // 组合API:我们可以理解为,内部可以放很多的组合</span><br><span class="line">  setup() &#123;</span><br><span class="line">     console.log(&#x27;setup()&#x27;, this) // 在beforeCreate之前执行,this必然是undefined</span><br><span class="line">     // 普通变量---虽然能够在页面中使用,但是,这玩意儿不是响应式的数据,意义不是特别大</span><br><span class="line">     let count = 100</span><br><span class="line">     const showMsg =()=&gt;&#123;</span><br><span class="line">     console.log(&#x27;我喜欢吃大豆腐沾臭豆腐拌蒜,豪哥说&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      count,</span><br><span class="line">      showMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-ref"><a href="#2-ref" class="headerlink" title="2. ref"></a>2. ref</h3><ul>
<li><p>作用: 定义一个数据的响应式,接受一个参数值并返回一个响应式且可改变的 ref 对象,ref 对象拥有一个指向内部值的单一属性 <code>value</code></p>
<blockquote>
<p>组合式API函数ref,函数执行传入的参数一般为基本类型数值，函数执行会返回,RefImpl这个类的实例-&gt;对象</p>
</blockquote>
<p>如果传入 ref 的是一个对象，将调用 <code>reactive</code> 方法对内部的value进行深层响应转换。</p>
<p>当 ref 作为渲染上下文的属性返回（即在<code>setup()</code> 返回的对象中）并在模板中使用时，它会自动解套，无需在模板内额外书写 <code>.value</code></p>
</li>
<li><p>语法: const xxx &#x3D; ref(initValue):   <font color="red">需要引入ref</font></p>
<ul>
<li>创建一个包含响应式数据的引用(reference)对象</li>
<li><strong>js中操作数据: xxx.value</strong></li>
<li><strong>模板中操作数据: 不需要.value</strong></li>
</ul>
</li>
<li><p>一般用来定义一个基本类型的响应式数据</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;about&quot;&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;count&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;button @click=&quot;increment&quot;&gt;更新&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  ref</span><br><span class="line">&#125; from &quot;vue&quot;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 包含响应式数据的引用对象</span><br><span class="line">    const count = ref(0) // count是一个引用对象, 内部包含存储数据的value属性</span><br><span class="line">    console.log(count, count.value)</span><br><span class="line"></span><br><span class="line">    // 更新响应式数据的函数</span><br><span class="line">    const increment = () =&gt; &#123;</span><br><span class="line">      count.value++</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123; // 对象中的属性和方法, 模板可以直接访问</span><br><span class="line">      count,</span><br><span class="line">      increment</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="3-reactive"><a href="#3-reactive" class="headerlink" title="3. reactive"></a>3. reactive</h3><ul>
<li>作用: 定义多个数据的响应式</li>
<li>const proxy &#x3D; reactive(obj): <strong>接收一个普通对象然后返回该普通对象</strong>的响应式代理对象</li>
<li>响应式转换是“深层的”：会影响对象内部所有嵌套的属性</li>
<li>内部基于 ES6 的 <code>Proxy</code> 实现，通过代理对象操作源对象内部数据都是响应式的</li>
<li>修改数据时，只能单独修改<code>obj.a = 2</code></li>
<li>或者使用<code>Object.assign(obj,&#123;a:2, b:3&#125;)</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;reactive的使用&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;名字:&#123;&#123;obj.name&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;年龄:&#123;&#123;obj.age&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;媳妇:&#123;&#123;obj.wife&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;changeData&quot;&gt;测试数据&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, reactive&#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 目标对象</span><br><span class="line">    const target =&#123;</span><br><span class="line">      name:&#x27;小强&#x27;,</span><br><span class="line">      age:20,</span><br><span class="line">      wife:&#123;</span><br><span class="line">        name:&#x27;小甜甜&#x27;,</span><br><span class="line">        age:20,</span><br><span class="line">        car:[&#x27;奔驰&#x27;,&#x27;奥迪&#x27;,&#x27;宝马&#x27;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 代理对象,返回的是一个Proxy类型的对象</span><br><span class="line">    // reactive用来定义引用类型的响应式数据的方法,ref用来定义基本类型数据的响应式数据</span><br><span class="line">    // reactive响应式数据的变化影响是深层次的</span><br><span class="line">    // 修改代理数据,目标对象的数据是会发生变化的,修改目标数据,代理数据是不会变化的</span><br><span class="line">    const obj = reactive(target)</span><br><span class="line">    const changeData=()=&gt;&#123;</span><br><span class="line">      // obj.name+=&#x27;===&#x27;</span><br><span class="line">      // obj.wife.name+=&#x27;===&#x27;</span><br><span class="line">      // obj.wife.car[3]=&#x27;奥拓&#x27;</span><br><span class="line">      target.name+=&#x27;===&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      obj,</span><br><span class="line">      changeData</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="4-比较Vue2与Vue3的响应式-重要"><a href="#4-比较Vue2与Vue3的响应式-重要" class="headerlink" title="4. 比较Vue2与Vue3的响应式(重要)"></a>4. 比较Vue2与Vue3的响应式(重要)</h3><h4 id="1-Vue2的响应式核心"><a href="#1-Vue2的响应式核心" class="headerlink" title="1) Vue2的响应式核心:"></a>1) Vue2的响应式核心:</h4><ul>
<li>对象: 通过defineProperty对对象的已有属性值的读取和修改进行劫持(监视&#x2F;拦截)</li>
<li>数组: 通过重写数组更新数组一系列更新元素的方法来实现元素修改的劫持</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, <span class="string">&#x27;count&#x27;</span>, &#123;</span><br><span class="line">    get () &#123;&#125;, </span><br><span class="line">    set () &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>问题<ul>
<li>对象直接新添加的属性或删除已有属性, 界面不会自动更新</li>
<li>直接通过下标替换元素或更新length, 界面不会自动更新   arr[1] &#x3D; {}</li>
</ul>
</li>
</ul>
<h4 id="2-Vue3的响应式核心"><a href="#2-Vue3的响应式核心" class="headerlink" title="2) Vue3的响应式核心:"></a>2) Vue3的响应式核心:</h4><ul>
<li><p>通过Proxy(代理):  拦截对data任意属性的任意(13种)操作, 包括属性值的读写, 属性的添加, 属性的删除等…</p>
</li>
<li><p>通过 Reflect(反射):  动态对被代理对象的相应属性进行特定的操作</p>
</li>
<li><p>文档:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p>
</li>
<li><pre><code class="js">Proxy:
    第一个参数：监听的对象，
    第二个参数：配置对象&#123;get(监听的对象,属性名)&#123;&#125;,set()&#123;&#125;&#125;
Reflect
    第一个参数：target：需要取值的目标对象
    第二个参数：prop：需要获取的属性值
    第三个参数：value：修改后的值
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">// Proxy+Reflect 实现响应式数据</span><br><span class="line">new Proxy(data, &#123;</span><br><span class="line">	// 拦截读取属性值</span><br><span class="line">    get (target, prop) &#123;</span><br><span class="line">    	return Reflect.get(target, prop)//在target身上读取prop属性</span><br><span class="line">    &#125;,</span><br><span class="line">    // 拦截设置属性值或添加新属性</span><br><span class="line">    // value:修改的属性值</span><br><span class="line">    set (target, prop, value) &#123;</span><br><span class="line">    	return Reflect.set(target, prop, value)//将target身上prop属性修改为value</span><br><span class="line">    &#125;,</span><br><span class="line">    // 拦截删除属性</span><br><span class="line">    deleteProperty (target, prop) &#123;</span><br><span class="line">    	return Reflect.deleteProperty(target, prop)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">proxy.name = &#x27;tom&#x27;  </span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>玉树临风美少年，揽镜自顾夜不眠 <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 自己手写代码实现数据代理----就是vue3.x语法中的数据代理的原理</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 实现数据代理---谁代理谁  两个对象: 代理对象和目标对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 目标对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> user = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">name</span>: <span class="string">&#x27;佐助&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">age</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">wife</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;小樱&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">19</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 代理对象,参数1:目标对象,参数2:处理器对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> proxyUser = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;劫持get执行了&#x27;</span>,prop)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, prop)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">set</span>(<span class="params">target, property, value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;劫持set执行了&#x27;</span>,property, value)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, property, value)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 删除</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">deleteProperty</span>(<span class="params">target, property</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;delete执行了&#x27;</span>,property)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, property)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 通过代理对象访问目标对象的属性,或者修改目标对象的属性,如果可以访问,或者可以修改,证明代理就是成功的</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// console.log(proxyUser.wife)</span></span></span><br><span class="line"><span class="language-javascript">    proxyUser.<span class="property">wife</span>.<span class="property">name</span> += <span class="string">&#x27;===&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(proxyUser)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">delete</span> proxyUser.<span class="property">wife</span>.<span class="property">name</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(proxyUser)</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 读取属性值</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(proxyUser===user)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(proxyUser.<span class="property">name</span>, proxyUser.<span class="property">age</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置属性值</span></span></span><br><span class="line"><span class="language-javascript">    proxyUser.<span class="property">name</span> = <span class="string">&#x27;tom&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    proxyUser.<span class="property">age</span> = <span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 添加属性</span></span></span><br><span class="line"><span class="language-javascript">    proxyUser.<span class="property">sex</span> = <span class="string">&#x27;男&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 删除属性</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">delete</span> proxyUser.<span class="property">sex</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-setup细节"><a href="#5-setup细节" class="headerlink" title="5. setup细节"></a>5. setup细节</h3><ul>
<li><p>setup执行的时机</p>
<ul>
<li>在beforeCreate之前执行(一次), 此时组件对象还没有创建</li>
<li>this是undefined, 不能通过this来访问data&#x2F;computed&#x2F;methods &#x2F; props</li>
<li>其实所有的composition API相关回调函数中也都不可以</li>
</ul>
</li>
<li><p>setup的返回值</p>
<ul>
<li>一般都返回一个对象: 为模板提供数据, 也就是模板中可以直接使用此对象中的所有属性&#x2F;方法</li>
<li>返回对象中的属性会与data函数返回对象的属性合并成为组件对象的属性</li>
<li>返回对象中的方法会与methods中的方法合并成功组件对象的方法</li>
<li>如果有重名, setup优先,现在是报错了</li>
<li>注意: <ul>
<li>一般不要混合使用: methods中可以访问setup提供的属性和方法, 但在setup方法中不能访问data和methods</li>
<li><font color="red"><strong>setup不能是一个async函数</strong></font>: 因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性数据</li>
</ul>
</li>
</ul>
</li>
<li><p>setup的参数</p>
<ul>
<li>setup(props, context) &#x2F; <code>setup(props, &#123;attrs, slots, emit&#125;)</code></li>
<li>props: 包含props配置声明且传入了的所有属性的对象</li>
<li>attrs: 包含没有在props配置中声明的属性的对象, 相当于 this.$attrs</li>
<li>slots: 包含所有传入的插槽内容的对象, 相当于 this.$slots</li>
<li>emit: 用来分发自定义事件的函数, 相当于 this.$emit</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--App父级组件--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;App父级组件,setup的细节&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;msg:&#123;&#123;msg&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;msg+=&#x27;===&#x27;&quot;&gt;更新数据&lt;/button&gt;</span><br><span class="line">  &lt;Child :msg=&quot;msg&quot; msg5=&quot;测试&quot; @xxx=&quot;xxx&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import Child from &#x27;./components/Child.vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  // 注册组件</span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 普通类型的响应式数据</span><br><span class="line">    const msg = ref(&#x27;what are you no sha lei&#x27;)</span><br><span class="line">    // 永爱更新普通数据</span><br><span class="line">    const xxx = (txt:string) =&gt; &#123;</span><br><span class="line">      msg.value += txt</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg,</span><br><span class="line">      xxx</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Child子级组件--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h3&gt;Child子级组件&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;父级传过来的msg:&#123;&#123;msg&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;updateParentMsg1&quot;&gt;修改父级组件中的数据&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">// 引入定义组件的api</span><br><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line">// 定义组件并暴露</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;Child&#x27;,</span><br><span class="line">  props: [&#x27;msg&#x27;],</span><br><span class="line">// props仍然是一个代理对象,内部有父级组件向子级组件传递进来的数据</span><br><span class="line">// props参数中的数据是否存在,要看当前的子级组件是否曾经使用props进行接收</span><br><span class="line">// 父级组件传入进来的数据,第一要通过props进行接收,虽然接收了,数据在组件的实例对象中,但是setup执行的时候,内部是没有this的</span><br><span class="line">// console.log(props)</span><br><span class="line">// context中有attrs对象,存储的是父级组件向子级组件传入进来的数据,但是这个数据没有使用props进行接收,相当于vue2.x中的this.$attrs属性</span><br><span class="line">// console.log(context)</span><br><span class="line">// context.emit(&#x27;xxx&#x27;,&#x27;嘎嘎&#x27;)</span><br><span class="line">// console.log(&#x27;setup执行了&#x27;,this) // this是undefined,原因:setup执行的时候,组件实例对象还没创建</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    // 用来获取父级组件传递过来的数据,需要子级组件使用props进行接收</span><br><span class="line">    console.log(props.msg)</span><br><span class="line">    // 用来获取父级组件传递过来的数据,没有使用props接收的数据</span><br><span class="line">    console.log(context.attrs.msg1)</span><br><span class="line">    // 按钮点击事件的回调函数,内部分发父级组件传递过来的自定义事件</span><br><span class="line">    const updateParentMsg1 = () =&gt; &#123;</span><br><span class="line">      context.emit(&#x27;updateMsg&#x27;, &#x27;真香啊&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      updateParentMsg1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">setup执行的时机</span><br><span class="line">在beforeCreate之前执行(一次), 此时组件对象还没有创建</span><br><span class="line">this是undefined, 不能通过this来访问data/computed/methods / props</span><br><span class="line">其实所有的composition API相关回调函数中也都不可以</span><br><span class="line">setup的返回值</span><br><span class="line">一般都返回一个对象: 为模板提供数据, 也就是模板中可以直接使用此对象中的所有属性/方法</span><br><span class="line">返回对象中的属性会与data函数返回对象的属性合并成为组件对象的属性</span><br><span class="line">返回对象中的方法会与methods中的方法合并成功组件对象的方法</span><br><span class="line">如果有重名, setup优先</span><br><span class="line">注意:</span><br><span class="line">一般不要混合使用: methods中可以访问setup提供的属性和方法, 但在setup方法中不能访问data和methods</span><br><span class="line">setup不能是一个async函数: 因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性数据(暂且这么理解,后期会有不同的解释)</span><br><span class="line">vue3.x中组件的实例对象this其实也是一个Proxy类型的代理对象</span><br><span class="line">setup(props, context) / setup(props, &#123;attrs, slots, emit&#125;)</span><br><span class="line">props: 包含props配置声明且传入了的所有属性的对象</span><br><span class="line">attrs: 包含没有在props配置中声明的属性的对象, 相当于 this.$attrs</span><br><span class="line">slots: 包含所有传入的插槽内容的对象, 相当于 this.$slots</span><br><span class="line">emit: 用来分发自定义事件的函数, 相当于 this.$emit</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-reactive与ref细节"><a href="#6-reactive与ref细节" class="headerlink" title="6. reactive与ref细节"></a>6. reactive与ref细节</h3><ul>
<li>是Vue3的 composition API中2个最重要的响应式API</li>
<li>ref用来处理基本类型数据, reactive用来处理对象(递归深度响应式)</li>
<li>如果用ref对象&#x2F;数组, 内部会自动将对象&#x2F;数组转换为reactive的代理对象</li>
<li>ref内部: 通过给value属性添加getter&#x2F;setter来实现对数据的劫持</li>
<li>reactive内部: 通过使用Proxy来实现对对象内部所有数据的劫持, 并通过Reflect操作对象内部数据</li>
<li>ref的数据操作: 在js中要.value, 在模板中不需要(内部解析模板时会自动添加.value)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;reactive与ref-细节&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;m1:&#123;&#123;m1&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;m2:&#123;&#123;m2&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;m3:&#123;&#123;m3&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;hr color=&quot;red&quot; /&gt;</span><br><span class="line">  &lt;button @click=&quot;update&quot;&gt;更新数据&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 用来定义基本类型的响应式数据</span><br><span class="line">    const m1 = ref(&#x27;abc&#x27;)</span><br><span class="line">    // 用来定义复杂类型的响应式数</span><br><span class="line">    const m2 = reactive(&#123;</span><br><span class="line">      name: &#x27;小强&#x27;,</span><br><span class="line">      wife: &#123;</span><br><span class="line">        name: &#x27;小甜甜&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    const m3 = ref(&#123;</span><br><span class="line">      name: &#x27;小强&#x27;,</span><br><span class="line">      wife: &#123;</span><br><span class="line">        name: &#x27;小甜甜&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(m3)</span><br><span class="line">    // 更新数据的方法</span><br><span class="line">    const update = () =&gt; &#123;</span><br><span class="line">     //  console.log(&#x27;哈哈&#x27;)</span><br><span class="line">     // m1.value+=&#x27;===&#x27; // 可以正常渲染---响应式的数据</span><br><span class="line">     // m2.wife.name+=&#x27;=====&#x27; // 同上</span><br><span class="line">     console.log(m1)</span><br><span class="line">     m3.value.wife.name+=&#x27;=====&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      m1,</span><br><span class="line">      m2,</span><br><span class="line">      m3,</span><br><span class="line">      update</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">// ref中可以放入复杂类型的数据,返回来的数据是Ref类型的,但是内部的数据已经成为Proxy类型的代理对象数据</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="7-计算属性与监视"><a href="#7-计算属性与监视" class="headerlink" title="7. 计算属性与监视"></a>7. 计算属性与监视</h3><ul>
<li><p>computed: </p>
<ul>
<li><p>与vue2中computed配置功能一致</p>
</li>
<li><p>简写：只有getter，返回的ref对象是<font color="red">只读</font>的！！！</p>
</li>
<li><p>完整写法：它可以使用具有 <code>get</code> 和 <code>set</code> 函数的对象来创建可修改的 ref 对象。</p>
</li>
</ul>
</li>
<li><p>watch函数</p>
<ul>
<li><p>与watch配置功能一致</p>
</li>
<li><p>监视指定的一个或多个响应式数据, 一旦数据变化, 就自动执行监视回调</p>
</li>
<li><p>默认初始时不执行回调, 但可以通过配置immediate为true, 来指定初始时立即执行第一次</p>
</li>
<li><p>通过配置deep为true, 来指定深度监视</p>
</li>
<li><p>参数：</p>
</li>
<li><p>第一个参数：</p>
<ul>
<li><p>一个函数，返回一个值</p>
</li>
<li><p>一个 ref</p>
</li>
<li><p>一个响应式对象</p>
</li>
<li><p>…或是由以上类型的值组成的数组</p>
</li>
<li><pre><code class="js">const state = reactive(&#123; count: 0 &#125;)
watch(
  () =&gt; state,
  (newValue, oldValue) =&gt; &#123;
    // newValue === oldValue
  &#125;,
  &#123; deep: true &#125;
)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- watchEffect函数</span><br><span class="line"></span><br><span class="line">  - 不用直接指定要监视的数据, 回调函数中**使用的哪些响应式数据**就监视哪些响应式数据</span><br><span class="line">  - 默认初始时就会执行第一次, 从而可以收集需要监视的数据</span><br><span class="line">  - watchEffect有点像computed：</span><br><span class="line">    - 但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</span><br><span class="line">    - 而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</span><br><span class="line"></span><br><span class="line">- computed的小例子</span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;about&quot;&gt;</span><br><span class="line">  &lt;h2&gt;count1: &#123;&#123;count1&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;count2: &#123;&#123;count2&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;count3: &#123;&#123;count3&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;button @click=&quot;increment&quot;&gt;加1&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;computed,ref&#125; from &quot;vue&quot;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const count1 = ref(0) // count是一个ref/引用对象, 内部包含存储数据的value属性</span><br><span class="line">    // 只有getter的计算属性</span><br><span class="line">    const count2 = computed(() =&gt; &#123; // 计算属性本质上也是一个ref对象</span><br><span class="line">      console.log(&#x27;count2 computed&#x27;, count.value)</span><br><span class="line">      return count1.value * 2</span><br><span class="line">    &#125;)</span><br><span class="line">    // 包含getter与setter的计算属性</span><br><span class="line">    const count3 = computed(&#123;</span><br><span class="line">      get () &#123;</span><br><span class="line">        return count1.value * 2</span><br><span class="line">      &#125;,</span><br><span class="line">      set (value: number) &#123;</span><br><span class="line">        count1.value = value/2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    // 更新响应式数据的函数</span><br><span class="line">    const increment = () =&gt; &#123;</span><br><span class="line">      count1.value++</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        count3.value += 2</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      count1,</span><br><span class="line">      increment,</span><br><span class="line">      count2,</span><br><span class="line">      count3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>computed和watch和watchEffect的案例</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;watch和computed及watchEffect函数&lt;/h2&gt;</span><br><span class="line">  &lt;fieldset&gt;</span><br><span class="line">    &lt;legend&gt;姓名操作&lt;/legend&gt;</span><br><span class="line">    姓氏:&lt;input type=&quot;text&quot; placeholder=&quot;请输入姓氏&quot; v-model=&quot;user.firstName&quot; /&gt;&lt;br /&gt;</span><br><span class="line">    名字:&lt;input type=&quot;text&quot; placeholder=&quot;请输入名字&quot; v-model=&quot;user.lastName&quot; /&gt;&lt;br /&gt;</span><br><span class="line">  &lt;/fieldset&gt;</span><br><span class="line"></span><br><span class="line">  &lt;fieldset&gt;</span><br><span class="line">    &lt;legend&gt;计算属性和监视的演示&lt;/legend&gt;</span><br><span class="line">    姓名:&lt;input type=&quot;text&quot; placeholder=&quot;显示姓名&quot; v-model=&quot;fullName1&quot; /&gt;&lt;br /&gt;</span><br><span class="line">    姓名:&lt;input type=&quot;text&quot; placeholder=&quot;显示姓名&quot; v-model=&quot;fullName2&quot; /&gt;&lt;br /&gt;</span><br><span class="line">    姓名:&lt;input type=&quot;text&quot; placeholder=&quot;显示姓名&quot; v-model=&quot;fullName3&quot; /&gt;&lt;br /&gt;</span><br><span class="line">  &lt;/fieldset&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  computed,</span><br><span class="line">  defineComponent,</span><br><span class="line">  reactive,</span><br><span class="line">  ref,</span><br><span class="line">  watch,</span><br><span class="line">  watchEffect</span><br><span class="line">&#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 定义响应式对象,存储姓氏和名字</span><br><span class="line">    const user = reactive(&#123;</span><br><span class="line">      firstName: &#x27;东方&#x27;,</span><br><span class="line">      lastName: &#x27;不败&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 通过计算属性的方式实现 第一个姓名的操作效果</span><br><span class="line">    const fullName1 = computed(() =&gt; &#123;</span><br><span class="line">      // get的简写形式</span><br><span class="line">      return user.firstName + &#x27;_&#x27; + user.lastName</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 通过计算属性的方式实现  第二个姓名的操作效果</span><br><span class="line">    const fullName2 = computed(&#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        return user.firstName + &#x27;_&#x27; + user.lastName</span><br><span class="line">      &#125;,</span><br><span class="line">      set(val: string) &#123;</span><br><span class="line">        // ts的语法</span><br><span class="line">        const names = val.split(&#x27;_&#x27;)</span><br><span class="line">        user.firstName = names[0]</span><br><span class="line">        user.lastName = names[1]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 通过监视的方式实现第三个姓名的操作</span><br><span class="line">    const fullName3 = ref(&#x27;&#x27;)</span><br><span class="line">    // 使用watch进行数据监视</span><br><span class="line">     watch(user, (&#123; firstName, lastName &#125;) =&gt; &#123;</span><br><span class="line">       fullName3.value = firstName + &#x27;_&#x27; + lastName</span><br><span class="line">     &#125;,&#123;immediate:true,deep:true&#125;) // 默认执行一次,深度监视</span><br><span class="line"></span><br><span class="line">    // watchEffect(()=&gt;&#123;</span><br><span class="line">    //   fullName3.value = user.firstName + &#x27;_&#x27; + user.lastName</span><br><span class="line">    // &#125;) // 默认就会执行一次</span><br><span class="line"></span><br><span class="line">    // watchEffect(() =&gt; &#123;</span><br><span class="line">    //   const names = fullName3.value.split(&#x27;_&#x27;)</span><br><span class="line">    //   user.firstName = names[0]</span><br><span class="line">    //   user.lastName = names[1]</span><br><span class="line">    // &#125;)</span><br><span class="line"></span><br><span class="line">    // watch也可以同时监视多个数据</span><br><span class="line">    // watch([user.firstName, user.lastName, fullName3], () =&gt; &#123;</span><br><span class="line">    //   console.log(&#x27;=====&#x27;)</span><br><span class="line">    // &#125;)</span><br><span class="line">    </span><br><span class="line">    // watch另一种写法</span><br><span class="line">    // watch([()=&gt;user.firstName, ()=&gt;user.lastName, fullName3], () =&gt; &#123;</span><br><span class="line">    //  console.log(&#x27;=====&#x27;)</span><br><span class="line">    // &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      user,</span><br><span class="line">      fullName1,</span><br><span class="line">      fullName2,</span><br><span class="line">      fullName3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-toRef"><a href="#8-toRef" class="headerlink" title="8. toRef"></a>8. toRef</h3><ul>
<li><p>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</p>
</li>
<li><p>语法：<code>const name = toRef(person,&#39;name&#39;)</code></p>
</li>
<li><p>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</p>
</li>
<li><p>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code></p>
</li>
</ul>
<p>问题: reactive的值在模板中使用时，需要一层层的点<code>.</code>很麻烦，而且reactive 对象取出的所有属性值都是非响应式的</p>
<p>解决: 利用 toRefs 可以将一个响应式 reactive 对象的所有原始属性转换为响应式的 ref 属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 原始写法 --&gt;</span><br><span class="line">    &lt;h4&gt;&#123;&#123; person.name &#125;&#125;&lt;/h4&gt;</span><br><span class="line">    &lt;h4&gt;年龄：&#123;&#123; person.age &#125;&#125;&lt;/h4&gt;</span><br><span class="line">    &lt;h4&gt;&#123;&#123; person.job.j1.salary &#125;&#125;&lt;/h4&gt;</span><br><span class="line">    &lt;button @click=&quot;person.age++&quot;&gt;修改年龄&lt;/button&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;!-- toRefs的写法 --&gt;</span><br><span class="line">    &lt;h5&gt;&#123;&#123; name &#125;&#125;&lt;/h5&gt;</span><br><span class="line">    &lt;h5&gt;&#123;&#123; age &#125;&#125;&lt;/h5&gt;</span><br><span class="line">    &lt;h5&gt;&#123;&#123; job.j1.salary &#125;&#125;&lt;/h5&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, reactive, toRefs &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    let person = reactive(&#123;</span><br><span class="line">      name: &#x27;张三&#x27;,</span><br><span class="line">      age: 18,</span><br><span class="line">      job: &#123;</span><br><span class="line">        j1: &#123;</span><br><span class="line">          salary: 20,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      //person,</span><br><span class="line">      //name:person.name,  //直接取出来的不是响应式的！！！</span><br><span class="line">      //name:ref(person.name), //修改的不是源数据，是自己创建的数据！！！</span><br><span class="line">      ...toRefs(person), //将reactive中的每一组key，value都展示出来(注意，只展示第一层)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>watch监视toRefs数据的小例子<ul>
<li>watch可以监视ref的数据</li>
<li>watch可以监视reactive的数据</li>
<li>watch可以监视一个函数，返回一个值的数据</li>
<li>watch可以监视上面所有的数据组成的数组数据</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;watch监视toRefs数据&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;count:&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;state1:&#123;&#123;state1&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;msg:&#123;&#123;msg&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;h3&gt;user:&#123;&#123;user&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;updateData&quot;&gt;更新数据&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">// 引入定义组件的api</span><br><span class="line">import &#123; defineComponent, ref, reactive, watch,toRefs &#125; from &#x27;vue&#x27;</span><br><span class="line">// 接口:可以理解为对象的类型,类的类型，函数的类型</span><br><span class="line">// 接口:可以理解为是一种限制,或者是一种能力,一种约束 </span><br><span class="line">// 定义一个接口</span><br><span class="line">interface StateData &#123;</span><br><span class="line">  msg: string</span><br><span class="line">  user: &#123;</span><br><span class="line">    name: string</span><br><span class="line">  &#125;</span><br><span class="line">  cars: string[]</span><br><span class="line">&#125;</span><br><span class="line">// 定义组件并暴露</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 定义ref类型的数据</span><br><span class="line">    const count = ref(10)</span><br><span class="line">    // watch监视一个ref数据</span><br><span class="line">    watch(count, () =&gt; &#123;</span><br><span class="line">      console.log(&#x27;count数据变化了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    // 定义reactive的响应式对象数据</span><br><span class="line">    const state1:StateData=reactive(&#123;</span><br><span class="line">      msg:&#x27;哈哈&#x27;,</span><br><span class="line">      user:&#123;</span><br><span class="line">        name:&#x27;小甜甜&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      cars:[&#x27;奔驰&#x27;,&#x27;宝马&#x27;,&#x27;奥迪&#x27;]</span><br><span class="line">    &#125;)</span><br><span class="line">    // watch监视一个reactive数据</span><br><span class="line">    watch(state1,()=&gt;&#123; // 自动开启深度监视</span><br><span class="line">      console.log(&#x27;state1数据变化了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">  </span><br><span class="line">    // watch监视一个函数返回值数据</span><br><span class="line">    // watch(()=&gt;state1.msg,()=&gt;&#123;</span><br><span class="line">    //   console.log(&#x27;state1数据变化了&#x27;)</span><br><span class="line">    // &#125;)</span><br><span class="line">    const state2 = toRefs(state1)</span><br><span class="line">    // watch监视多个数据</span><br><span class="line">    // state2是基本类型对象数据,不是ref也不是reactive定义的响应式对象数据,但是state2.user.name修改的是state1中的数据,这个数据变化了,影响了state2对象中的数据,所以,监视就有效的触发了。</span><br><span class="line">    // 单独监视state2，监视是不会触发的。</span><br><span class="line">    watch([count,()=&gt;state1.msg,state2],()=&gt;&#123;</span><br><span class="line">      console.log(&#x27;监视多个数据&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    const updateData = () =&gt; &#123;</span><br><span class="line">      // count.value += 10</span><br><span class="line">      // 深度修改数据</span><br><span class="line">      // state1.msg+=&#x27;====&#x27;</span><br><span class="line">      // state1.user.name+=&#x27;====&#x27;</span><br><span class="line">      // state2.msg.value+=&#x27;===&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      count,</span><br><span class="line">      updateData,</span><br><span class="line">      // state1</span><br><span class="line">      // ...state1 // 不是响应式的数据</span><br><span class="line">      ...state2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  reactive定义的是响应式的对象数据,是Proxy类型的</span><br><span class="line">  里面的属性并不是响应式的,如果修改了属性值,实际上是在修改该响应式对象的数据,所以,页面会重新渲染。</span><br><span class="line">  如果reactive定义的响应式对象数据,内部的属性如果也是响应式的,那么解构后,模版中可以直接使用,但是里面的属性不是响应式的,所以，一旦修改了属性值,解构后的属性在页面中是不会发生变化的,页面也不会重新渲染。</span><br><span class="line">  为了简化代码,把当前响应式对象数据进行解构，结果发现:解构后的属性不是响应式的,如何解决?</span><br><span class="line">  使用toRefs方法----组合api方法</span><br><span class="line">  toRefs的作用:把响应式对象数据转成普通类型的数据,但是,这个数据也是响应式的,而且,内部的属性都是Ref类型的数据,Ref类型的数据都是响应式的数据,所以，即使，把当前的toRefs转换的数据解构了，里面的属性仍然是响应式的，页面可以直接使用，也会重新渲染。</span><br></pre></td></tr></table></figure>

<h3 id="9-ref获取元素"><a href="#9-ref获取元素" class="headerlink" title="9. ref获取元素"></a>9. ref获取元素</h3><p> 利用ref函数获取组件中的标签元素</p>
<p>ref属性:右侧这里需要的是<font color="red"><strong>字符串</strong></font>或者<font color="red">**函数 **</font></p>
<p>如果用于普通 DOM 元素，引用将是元素本身；如果用于子组件，引用将是子组件的实例</p>
<blockquote>
<p>用法：声明一个同名ref对象:用来获取页面DOM<br><font color="red"><strong>ref对象的名字需要与模板ref属性值名字一致</strong></font></p>
</blockquote>
<p>功能需求: 让输入框自动获取焦点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;ref的另一个作用:可以获取页面中的元素&lt;/h2&gt;</span><br><span class="line">  &lt;input type=&quot;text&quot; ref=&quot;inputRef&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, onMounted, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line"></span><br><span class="line">  // 需求:当页面加载完毕后,页面中的文本框可以直接获取焦点(自动获取焦点)</span><br><span class="line"></span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 默认是空的,页面加载完毕,说明组件已经存在了,获取文本框元素</span><br><span class="line">    const inputRef = ref&lt;HTMLElement | null&gt;(null)</span><br><span class="line">    // 页面加载后的生命周期组合API</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      inputRef.value &amp;&amp; inputRef.value.focus() // 自动获取焦点</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      inputRef,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="其它-Composition-API"><a href="#其它-Composition-API" class="headerlink" title="其它 Composition API"></a>其它 Composition API</h2><h3 id="1-shallowReactive-与-shallowRef"><a href="#1-shallowReactive-与-shallowRef" class="headerlink" title="1. shallowReactive 与 shallowRef"></a>1. shallowReactive 与 shallowRef</h3><ul>
<li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p>
</li>
<li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p>
</li>
<li><p>什么时候使用?</p>
<ul>
<li>如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 &#x3D;&#x3D;&#x3D;&gt; shallowReactive。</li>
<li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 &#x3D;&#x3D;&#x3D;&gt; shallowRef。</li>
</ul>
</li>
</ul>
<h3 id="2-readonly-与-shallowReadonly"><a href="#2-readonly-与-shallowReadonly" class="headerlink" title="2. readonly 与 shallowReadonly"></a>2. readonly 与 shallowReadonly</h3><ul>
<li>readonly: 让一个响应式数据变为只读的（深只读）。</li>
<li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。</li>
<li>应用场景: 不希望数据被修改时。例如，使用比人的组件时使用，</li>
</ul>
<h3 id="3-toRaw-与-markRaw"><a href="#3-toRaw-与-markRaw" class="headerlink" title="3. toRaw 与 markRaw"></a>3. toRaw 与 markRaw</h3><ul>
<li>toRaw：<ul>
<li>作用：将一个由<code>reactive</code>生成的<strong style="color:orange">响应式对象</strong>转为<strong style="color:orange">普通对象</strong>。对ref类型的响应式数据不生效</li>
<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>
</ul>
</li>
<li>markRaw：<ul>
<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>
<li>应用场景:<ol>
<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。(响应式的数据，在添加一个属性时，这个属性也是响应式的)</li>
<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="4-customRef"><a href="#4-customRef" class="headerlink" title="4. customRef"></a>4. customRef</h3><ul>
<li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p>
</li>
<li><p>实现防抖效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input type=&quot;text&quot; v-model=&quot;keyword&quot; /&gt;</span><br><span class="line">  &lt;h3&gt;&#123;&#123; keyword &#125;&#125;&lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, customRef &#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Demo&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span><br><span class="line">    //自定义一个myRef</span><br><span class="line">    function myRef(value: string, delay: number) &#123;</span><br><span class="line">      let timer: number</span><br><span class="line">      //通过customRef去实现自定义</span><br><span class="line">      return customRef((track, trigger) =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          get() &#123;</span><br><span class="line">            track() //告诉Vue这个value值是需要被“追踪”的</span><br><span class="line">            return value</span><br><span class="line">          &#125;,</span><br><span class="line">          set(newValue) &#123;</span><br><span class="line">            clearTimeout(timer) //清除上一次的定时器，</span><br><span class="line">            timer = setTimeout(() =&gt; &#123;</span><br><span class="line">              value = newValue //将接收到的最新的值赋值给初始值</span><br><span class="line">              trigger() //告诉Vue去更新界面</span><br><span class="line">            &#125;, delay)</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    let keyword = myRef(&#x27;hello&#x27;, 500) //使用程序员自定义的ref</span><br><span class="line">    return &#123;</span><br><span class="line">      keyword,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-provide-与-inject"><a href="#5-provide-与-inject" class="headerlink" title="5. provide 与 inject"></a>5. provide 与 inject</h3><ul>
<li><p>作用：实现<strong style="color:#DD5145">祖与后代组件间</strong>通信；</p>
</li>
<li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p>
</li>
<li><p>具体写法：</p>
<ol>
<li><p>祖组件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">let</span> car = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;奔驰&#x27;</span>,<span class="attr">price</span>:<span class="string">&#x27;40万&#x27;</span>&#125;)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;car&#x27;</span>,car)</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>后代组件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props,context</span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">const</span> car = <span class="title function_">inject</span>(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;car&#125;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="6-响应式数据的判断"><a href="#6-响应式数据的判断" class="headerlink" title="6. 响应式数据的判断"></a>6. 响应式数据的判断</h3><ul>
<li>isRef: 检查一个值是否为一个 ref 对象</li>
<li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li>
<li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li>
<li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li>
</ul>
<h2 id="新的组件"><a href="#新的组件" class="headerlink" title="新的组件"></a>新的组件</h2><h3 id="1-Fragment"><a href="#1-Fragment" class="headerlink" title="1.Fragment"></a>1.Fragment</h3><ul>
<li>在Vue2中: 组件必须有一个根标签</li>
<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<h3 id="2-Teleport"><a href="#2-Teleport" class="headerlink" title="2.Teleport"></a>2.Teleport</h3><ul>
<li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style="color:#DD5145">组件html结构</strong>移动到指定位置的技术。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;移动位置&quot;&gt;</span><br><span class="line">	&lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;</span><br><span class="line">		&lt;div class=&quot;dialog&quot;&gt;</span><br><span class="line">			&lt;h3&gt;我是一个弹窗&lt;/h3&gt;</span><br><span class="line">			&lt;button @click=&quot;isShow = false&quot;&gt;关闭弹窗&lt;/button&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-Suspense-还不稳定"><a href="#3-Suspense-还不稳定" class="headerlink" title="3.Suspense(还不稳定)"></a>3.Suspense(还不稳定)</h3><ul>
<li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>
</li>
<li><p>使用步骤：</p>
<ul>
<li><p>异步引入组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineAsyncComponent&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">()=&gt;</span><span class="keyword">import</span>(<span class="string">&#x27;./components/Child.vue&#x27;</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">		&lt;h3&gt;我是App组件&lt;/h3&gt;</span><br><span class="line">		&lt;Suspense&gt;</span><br><span class="line">			&lt;template v-slot:default&gt;</span><br><span class="line">				&lt;Child/&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">			&lt;template v-slot:fallback&gt;</span><br><span class="line">				&lt;h3&gt;加载中.....&lt;/h3&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">		&lt;/Suspense&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-全局API的转移"><a href="#1-全局API的转移" class="headerlink" title="1.全局API的转移"></a>1.全局API的转移</h3><ul>
<li><p>Vue 2.x 有许多全局 API 和配置。</p>
<ul>
<li><p>例如：注册全局组件、注册全局指令等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册全局组件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册全局指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">focus</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Vue3.0中对这些API做出了调整：</p>
<ul>
<li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p>
<table>
<thead>
<tr>
<th>2.x 全局 API（<code>Vue</code>）</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config.xxxx</td>
<td>app.config.xxxx</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><strong style="color:#DD5145">移除</strong></td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin(vue3中不推荐使用)</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h3 id="2-其他改变"><a href="#2-其他改变" class="headerlink" title="2.其他改变"></a>2.其他改变</h3><ul>
<li><p>data选项应始终被声明为一个函数。</p>
</li>
<li><p>过度类名的更改：</p>
<ul>
<li><p>Vue2.x写法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-leave</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Vue3.x写法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter-from</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.v-leave-from</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong style="color:#DD5145">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p>
</li>
<li><p><strong style="color:#DD5145">移除</strong><code>v-on.native</code>修饰符</p>
<ul>
<li><p>父组件中绑定事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;my-component</span><br><span class="line">  v-on:close=&quot;handleComponentEvent&quot;</span><br><span class="line">  v-on:click=&quot;handleNativeClickEvent&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>子组件中声明自定义事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    emits: [&#x27;close&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong style="color:#DD5145">移除</strong>过滤器（filter）</p>
<blockquote>
<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>
</blockquote>
</li>
<li><p>……</p>
</li>
</ul>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="1-vue2-x的生命周期"><a href="#1-vue2-x的生命周期" class="headerlink" title="1. vue2.x的生命周期"></a>1. vue2.x的生命周期</h3><p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/lifecycle_2.png" alt="lifecycle_2"></p>
<h3 id="2-vue3的生命周期"><a href="#2-vue3的生命周期" class="headerlink" title="2. vue3的生命周期"></a>2. vue3的生命周期</h3><p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/lifecycle_3.png" alt="lifecycle_3"></p>
<h3 id="3-生命周期对比"><a href="#3-生命周期对比" class="headerlink" title="3.生命周期对比"></a>3.生命周期对比</h3><p><strong>与 2.x 版本生命周期相对应的组合式 API</strong></p>
<ul>
<li><code>beforeCreate</code> -&gt; 使用 <code>setup()</code></li>
<li><code>created</code> -&gt; 使用 <code>setup()</code></li>
<li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li>
<li><code>mounted</code> -&gt; <code>onMounted</code></li>
<li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li>
<li><code>updated</code> -&gt; <code>onUpdated</code></li>
<li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></li>
<li><code>destroyed</code> -&gt; <code>onUnmounted</code></li>
<li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li>
</ul>
<p><strong>&#x2F;&#x2F; 2.0中为 beforeDestroy 和 destroyed</strong></p>
<ul>
<li><strong>beforeUnmount -&gt; onBeforeUnmount</strong></li>
<li><strong>unMounted -&gt; onUnmounted</strong></li>
</ul>
<p>&#x2F;&#x2F; 用于处理错误</p>
<ul>
<li>errorCaptured -&gt; onErrorCaptured</li>
</ul>
<p>&#x2F;&#x2F; 组合式 API 还提供了以下调试钩子函数：</p>
<ul>
<li>renderTracked -&gt; onRenderTracked</li>
<li>renderTriggered -&gt; onRenderTriggered</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--App父级组件--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;App父级组件&lt;/h2&gt;</span><br><span class="line">  &lt;button @click=&quot;isShow=!isShow&quot;&gt;显示和隐藏&lt;/button&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;Child v-if=&quot;isShow&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import Child from &#x27;./components/Child.vue&#x27;</span><br><span class="line">import &#123; defineComponent,ref &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  // 注册组件</span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const isShow = ref(true)</span><br><span class="line">    return &#123;</span><br><span class="line">      isShow</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Child子级组件--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;子级组件&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;&#123;&#123;msg2&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;button @click=&quot;msg2+=&#x27;===&#x27;&quot;&gt;更改数据&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  defineComponent,</span><br><span class="line">  onBeforeMount,</span><br><span class="line">  onBeforeUnmount,</span><br><span class="line">  onBeforeUpdate,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUnmounted,</span><br><span class="line">  onUpdated,</span><br><span class="line">  ref</span><br><span class="line">&#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    console.log(&#x27;2.x===beforeCreate====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    console.log(&#x27;2.x===created====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeMount() &#123;</span><br><span class="line">    console.log(&#x27;2.x===beforeMount====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(&#x27;2.x===mounted====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeUpdate() &#123;</span><br><span class="line">    console.log(&#x27;2.x===beforeUpdate====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  updated() &#123;</span><br><span class="line">    console.log(&#x27;2.x===updated====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // beforeDestroy() &#123;</span><br><span class="line">  //   console.log(&#x27;2.x===beforeDestroy====执行了&#x27;)</span><br><span class="line">  // &#125;,</span><br><span class="line">  // destroyed() &#123;</span><br><span class="line">  //   console.log(&#x27;2.x===destroyed====执行了&#x27;)</span><br><span class="line">  // &#125;,</span><br><span class="line">  beforeUnmount() &#123;</span><br><span class="line">    console.log(&#x27;2.x===beforeUnmount====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  unmounted() &#123;</span><br><span class="line">    console.log(&#x27;2.x===unmounted====执行了&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // vue3.x的组件中,支持vue2.x的生命周期,但是有两个废掉了</span><br><span class="line">  setup() &#123;</span><br><span class="line">    console.log(&#x27;3.x的setup&#x27;)</span><br><span class="line">    const msg2 = ref(&#x27;xxx&#x27;)</span><br><span class="line">    // setup函数相当于beforeCreate和created这两个生命周期</span><br><span class="line">    onBeforeMount(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onBeforeMount====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onMounted====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onBeforeUpdate(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onBeforeUpdate====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUpdated(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onUpdated====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onBeforeUnmount(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onBeforeUnmount====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;3.x===onUnmounted====执行了&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      msg2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="自定义hooks函数"><a href="#自定义hooks函数" class="headerlink" title="自定义hooks函数"></a>自定义hooks函数</h2><h3 id="1-compostion-API-VS-Option-API"><a href="#1-compostion-API-VS-Option-API" class="headerlink" title="1. compostion API   VS Option API"></a>1. compostion API   VS Option API</h3><p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/options%20API.gif" alt="options API"></p>
<p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/composition%20API.gif" alt="composition API"></p>
<p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/composition%20API2.gif" alt="composition API2"></p>
<h3 id="理解自定义Hook"><a href="#理解自定义Hook" class="headerlink" title="理解自定义Hook"></a>理解自定义Hook</h3><ul>
<li><p>作用: 对多个组件重复的功能进行提取封装</p>
</li>
<li><p>使用Vue3的组合API封装的可复用的功能函数</p>
</li>
<li><p>自定义hook的作用类似于vue2中的mixin技术</p>
</li>
<li><p>自定义Hook的优势: 很清楚复用功能代码的来源, 更清楚易懂</p>
</li>
</ul>
<h3 id="需求1"><a href="#需求1" class="headerlink" title="需求1"></a>需求1</h3><ul>
<li>收集用户鼠标点击的页面坐标</li>
<li>hooks&#x2F;useMousePosition.ts</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">自定义hooks: 收集用户鼠标点击的页面坐标</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> &#123; onBeforeUnmount, onMounted, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 初始化坐标数据</span></span><br><span class="line">  <span class="keyword">const</span> x = <span class="title function_">ref</span>(-<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> y = <span class="title function_">ref</span>(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点击事件的回调函数</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">clickHandler</span> = (<span class="params">event: MouseEvent</span>) =&gt; &#123;</span><br><span class="line">    x.<span class="property">value</span> = event.<span class="property">pageX</span></span><br><span class="line">    y.<span class="property">value</span> = event.<span class="property">pageY</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 挂载后绑定点击监听</span></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickHandler)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 页面卸载之前的生命周期组合API</span></span><br><span class="line">  <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickHandler)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    x,</span><br><span class="line">    y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;自定义hook函数操作&lt;/h2&gt;</span><br><span class="line">  &lt;h2&gt;x:&#123;&#123; x &#125;&#125;,y:&#123;&#123; y &#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import useMousePosition from &#x27;./hooks/useMousePosition&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  // 需求1:用户在页面中点击页面,把点击的位置的横纵坐标收集起来并展示出来</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const &#123; x, y &#125; = useMousePosition()</span><br><span class="line">    return &#123;</span><br><span class="line">      x,</span><br><span class="line">      y</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="需求2"><a href="#需求2" class="headerlink" title="需求2:"></a>需求2:</h3><ul>
<li><p>封装异步请求</p>
</li>
<li><p>接口1: <a target="_blank" rel="noopener" href="https://dog.ceo/api/breeds/image/random">https://dog.ceo/api/breeds/image/random</a></p>
</li>
<li><p>接口2: <a target="_blank" rel="noopener" href="https://api.thecatapi.com/v1/images/search">https://api.thecatapi.com/v1/images/search</a></p>
</li>
<li><p>hooks&#x2F;useUrlLoader.ts</p>
</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">使用axios发送异步ajax请求</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useUrlLoader</span>(<span class="params">url: <span class="built_in">string</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">ref</span>()</span><br><span class="line">  <span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">const</span> errorMsg = <span class="title function_">ref</span>()</span><br><span class="line"></span><br><span class="line">  axios.<span class="title function_">get</span>(url)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">      result.<span class="property">value</span> = response.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">      errorMsg.<span class="property">value</span> = e.<span class="property">message</span> || <span class="string">&#x27;未知错误&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loading,</span><br><span class="line">    result,</span><br><span class="line">    errorMsg,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在组件中使用自定义hooks</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;about&quot;&gt;</span><br><span class="line">  &lt;h2&gt;x: &#123;&#123;x&#125;&#125;, y: &#123;&#123;y&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;h2 v-if=&quot;loading&quot;&gt;LOADING...&lt;/h2&gt;</span><br><span class="line">  &lt;h2 v-else-if=&quot;errorMsg&quot;&gt;&#123;&#123;errorMsg&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;img v-if=&quot;result&quot; :src=&quot;result.message&quot; alt=&quot;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  ref</span><br><span class="line">&#125; from &quot;vue&quot;</span><br><span class="line">import useMousePosition from &#x27;../hooks/useMousePosition&#x27;</span><br><span class="line">import useUrlLoader from &#x27;../hooks/useUrlLoader&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    const &#123;x, y&#125; = useMousePosition()</span><br><span class="line">    const &#123;loading, result, errorMsg&#125; = useUrlLoader(&#x27;https://dog.ceo/api/breeds/image/random&#x27;)</span><br><span class="line">    </span><br><span class="line">    return &#123;</span><br><span class="line">      x,</span><br><span class="line">      y,</span><br><span class="line">      loading, </span><br><span class="line">      result, </span><br><span class="line">      errorMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="泛型强化类型检查"><a href="#泛型强化类型检查" class="headerlink" title="泛型强化类型检查"></a>泛型强化类型检查</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入axios</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 发送ajax的请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> &lt;T&gt;(<span class="attr">url</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">  <span class="comment">// 加载的状态</span></span><br><span class="line">  <span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// 请求成功的数据</span></span><br><span class="line">  <span class="keyword">const</span> data = ref&lt;T | <span class="literal">null</span>&gt;(<span class="literal">null</span>) <span class="comment">// 坑</span></span><br><span class="line">  <span class="comment">// 错误信息</span></span><br><span class="line">  <span class="keyword">const</span> errorMsg = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="comment">// 发送请求</span></span><br><span class="line">  axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 改变加载状态</span></span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    data.<span class="property">value</span> = response.<span class="property">data</span></span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 改变加载状态</span></span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    errorMsg.<span class="property">value</span> = error.<span class="property">message</span> || <span class="string">&#x27;未知错误&#x27;</span></span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loading,</span><br><span class="line">    result,</span><br><span class="line">    errorMsg</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;about&quot;&gt;</span><br><span class="line">  &lt;h2&gt;x: &#123;&#123;x&#125;&#125;, y: &#123;&#123;y&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;h2 v-if=&quot;loading&quot;&gt;LOADING...&lt;/h2&gt;</span><br><span class="line">  &lt;h2 v-else-if=&quot;errorMsg&quot;&gt;&#123;&#123;errorMsg&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;img v-if=&quot;result&quot; :src=&quot;result[0].url&quot; alt=&quot;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  ref, watch</span><br><span class="line">&#125; from &quot;vue&quot;</span><br><span class="line">import useMousePosition from &#x27;../hooks/useMousePosition&#x27;</span><br><span class="line">import useUrlLoader from &#x27;../hooks/useUrlLoader&#x27;</span><br><span class="line"></span><br><span class="line">interface DogResult &#123;</span><br><span class="line">  message: string</span><br><span class="line">  status: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface CatResult &#123;</span><br><span class="line">  id: string</span><br><span class="line">  url: string</span><br><span class="line">  width: number</span><br><span class="line">  height: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    const &#123;x, y&#125; = useMousePosition()</span><br><span class="line">    // const &#123;loading, result, errorMsg&#125; = useUrlLoader&lt;DogResult&gt;(&#x27;https://dog.ceo/api/breeds/image/random&#x27;)</span><br><span class="line">    const &#123;loading, result, errorMsg&#125; = useUrlLoader&lt;CatResult[]&gt;(&#x27;https://api.thecatapi.com/v1/images/search&#x27;)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      x,</span><br><span class="line">      y,</span><br><span class="line">      loading, </span><br><span class="line">      result, </span><br><span class="line">      errorMsg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>响应式数据的判断方式:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h2&gt;响应式数据的判断&lt;/h2&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, isProxy, isReactive, isReadonly, isRef, reactive, readonly, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name:&#x27;App&#x27;,</span><br><span class="line">    // isRef: 检查一个值是否为一个 ref 对象</span><br><span class="line">    // isReactive: 检查一个对象是否是由 reactive 创建的响应式代理</span><br><span class="line">    // isReadonly: 检查一个对象是否是由 readonly 创建的只读代理</span><br><span class="line">    // isProxy: 检查一个对象是否是由 reactive 或者 readonly 方法创建的代理</span><br><span class="line"></span><br><span class="line">    setup()&#123;</span><br><span class="line">      // isRef: 检查一个值是否为一个 ref 对象</span><br><span class="line">      console.log(isRef(ref(&#123;&#125;)))</span><br><span class="line">      // isReactive: 检查一个对象是否是由 reactive 创建的响应式代理</span><br><span class="line">      console.log(isReactive(reactive(&#123;&#125;)))</span><br><span class="line">      // isReadonly: 检查一个对象是否是由 readonly 创建的只读代理</span><br><span class="line">      console.log(isReadonly(readonly(&#123;&#125;)))</span><br><span class="line">      // isProxy: 检查一个对象是否是由 reactive 或者 readonly 方法创建的代理</span><br><span class="line">      console.log(isProxy(readonly(&#123;&#125;)))</span><br><span class="line">      console.log(isProxy(reactive(&#123;&#125;)))</span><br><span class="line"></span><br><span class="line">      return&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="VueRouter4的使用"><a href="#VueRouter4的使用" class="headerlink" title="VueRouter4的使用"></a>VueRouter4的使用</h2><h3 id="1-了解vue-router4相关信息"><a href="#1-了解vue-router4相关信息" class="headerlink" title="1. 了解vue-router4相关信息"></a>1. 了解vue-router4相关信息</h3><p>Vue Router 是 <a target="_blank" rel="noopener" href="http://v3.vuejs.org/">Vue.js</a> 的官方路由。它与 Vue.js 核心深度集成，让用 Vue.js 构建单页应用变得轻而易举。功能包括：</p>
<ul>
<li>嵌套路由映射</li>
<li>动态路由选择</li>
<li>模块化、基于组件的路由配置</li>
<li>路由参数、查询、通配符</li>
<li>展示由 Vue.js 的过渡系统提供的过渡效果</li>
<li>细致的导航控制</li>
<li>自动激活 CSS 类的链接</li>
<li>HTML5 history 模式或 hash 模式</li>
<li>可定制的滚动行为</li>
<li>URL 的正确编码</li>
</ul>
<h3 id="2-安装vue-router4"><a href="#2-安装vue-router4" class="headerlink" title="2. 安装vue-router4"></a>2. 安装vue-router4</h3><p>Vue Router 是 <a target="_blank" rel="noopener" href="http://v3.vuejs.org/">Vue.js</a> 的官方路由。它与 Vue.js 核心深度集成，让用 Vue.js 构建单页应用变得轻而易举。功能包括：</p>
<h3 id="2-配置vite"><a href="#2-配置vite" class="headerlink" title="2. 配置vite"></a>2. 配置vite</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">tsconfig.json 中新增</span><br><span class="line"><span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 新的配置</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;./src/*&quot;</span><span class="punctuation">]</span> <span class="comment">// 更加智能</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">package.json中修改 </span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite --host 0.0.0.0 --port 3001&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">或者 vite.config.ts中配置</span><br><span class="line"><span class="comment">// 新的配置</span></span><br><span class="line">import <span class="punctuation">&#123;</span> resolve <span class="punctuation">&#125;</span> from &#x27;path&#x27; <span class="comment">// 必须得下载@types/node, 否则不识别__dirname,方便引入文件路径,还报错就重启</span></span><br><span class="line">export default defineConfig(<span class="punctuation">&#123;</span></span><br><span class="line"> plugins<span class="punctuation">:</span> <span class="punctuation">[</span>vue()<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"> server<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  host<span class="punctuation">:</span>&#x27;<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">  port<span class="punctuation">:</span><span class="number">3001</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 新的配置</span></span><br><span class="line">  resolve<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    alias<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// 必须得下载@types/node, 否则不识别__dirname,方便引入文件路径</span></span><br><span class="line">      &#x27;@&#x27;<span class="punctuation">:</span> resolve(__dirname<span class="punctuation">,</span> <span class="string">&quot;src&quot;</span>)</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    extensions<span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.vue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.jsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.tsx&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 导入时想要省略的扩展名列表。</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-vue-router4router-link和router-view为什么能够直接用"><a href="#3-vue-router4router-link和router-view为什么能够直接用" class="headerlink" title="3. vue-router4router-link和router-view为什么能够直接用"></a>3. vue-router4router-link和router-view为什么能够直接用</h3><p>安装<code>router</code>插件的时候注册了这两个全局组件，所以能直接使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在node_modules目录中的.<span class="property">vite</span>目录中的deps目录中:vue-router.<span class="property">js</span>中</span><br><span class="line"><span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">     <span class="keyword">const</span> router2 = <span class="variable language_">this</span>;</span><br><span class="line">     app.<span class="title function_">component</span>(<span class="string">&quot;RouterLink&quot;</span>, <span class="title class_">RouterLink</span>);</span><br><span class="line">     app.<span class="title function_">component</span>(<span class="string">&quot;RouterView&quot;</span>, <span class="title class_">RouterView</span>);</span><br></pre></td></tr></table></figure>



<h3 id="4-使用vue-router4及hash和history模式"><a href="#4-使用vue-router4及hash和history模式" class="headerlink" title="4. 使用vue-router4及hash和history模式"></a>4. 使用vue-router4及hash和history模式</h3><p>Hash模式的URL中有一个#号,<a target="_blank" rel="noopener" href="http://localhost:3000/#/home%E5%8F%B7%E5%90%8E%E9%9D%A2%E7%9A%84%E5%B0%B1%E6%98%AFHash%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%A8%A1%E5%BC%8F%E4%BB%A5%E5%89%8D%E6%98%AFSPA%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%BD%86%E6%98%AF%E9%93%BE%E6%8E%A5%E6%9C%89%E4%B8%80%E4%B8%AA#%E5%8F%B7%E6%AF%94%E8%BE%83%E9%9A%BE%E7%9C%8B%E3%80%82">http://localhost:3000/#/home号后面的就是Hash地址，这个模式以前是SPA的常用模式，但是链接有一个#号比较难看。</a></p>
<p>H5模式和正常的链接地址一样的,<a target="_blank" rel="noopener" href="http://localhost:3000/home">http://localhost:3000/home</a>, 这个地址大家都能正常的接受，但是得需要服务器支持。 原因是浏览器中输入<a target="_blank" rel="noopener" href="http://localhost:3000/home%E6%94%AF%E6%8C%81%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A5%E4%B8%BA%E8%A6%81%E8%AE%BF%E9%97%AE%E6%A0%B9%E8%B7%AF%E5%8A%B2%E4%B8%8B%E7%9A%84home%E7%9B%AE%E5%BD%95%E7%9A%84HTML%E6%96%87%E4%BB%B6%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E8%AE%BF%E9%97%AE%E6%A0%B9%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84HTML%E6%96%87%E4%BB%B6%E3%80%82">http://localhost:3000/home支持，服务器以为要访问根路劲下的home目录的HTML文件，而不是访问根路径下的HTML文件。</a></p>
<p>webpack和vite启动的服务器是支持HTML5模式的，所以开发环境使用HTML5模式没有问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="comment">// history: createWebHashHistory(), // hash模式</span></span><br><span class="line">  <span class="attr">history</span>:<span class="title function_">createWebHistory</span>(), <span class="comment">// history模式</span></span><br><span class="line">  routes, <span class="comment">// 路由</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="5-vue-router4选中样式linkActiveClass"><a href="#5-vue-router4选中样式linkActiveClass" class="headerlink" title="5. vue-router4选中样式linkActiveClass"></a>5. vue-router4选中样式linkActiveClass</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  routes, <span class="comment">// 路由</span></span><br><span class="line">  <span class="attr">linkActiveClass</span>:<span class="string">&#x27;my-router-active&#x27;</span> <span class="comment">// 设置路由链接的选中的类样式的名字</span></span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.html中的header标签中</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.my-router-active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#d43c33</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#02a774</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-vue-router4参数-query和params"><a href="#6-vue-router4参数-query和params" class="headerlink" title="6. vue-router4参数(query和params)"></a>6. vue-router4参数(query和params)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query参数传递:</span><br><span class="line">&lt;router-link :to=&quot;&#123;name: &#x27;detail&#x27;, query: &#123;id: m.id&#125;&#125;&quot;&gt;Message&lt;/router-link&gt;</span><br><span class="line">query参数接收:</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">const route = useRoute() // 路由信息对象</span><br><span class="line">const id = route.query.id</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">动态路由:</span><br><span class="line">routes.<span class="property">ts</span>中</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;detail&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/about/message/detail/:id&#x27;</span>, <span class="comment">// 动态路由</span></span><br><span class="line">            <span class="attr">component</span>:<span class="title class_">MessageDetail</span></span><br><span class="line">          &#125;</span><br><span class="line">:id 表示 路由的路径是动态的</span><br><span class="line"></span><br><span class="line">给组件传递props</span><br><span class="line">前面在组件中需要使用<span class="title function_">useRoute</span>()获取到路由，然后获取对应的route.<span class="property">params</span>, 我们可以通过另外一种方式获取route.<span class="property">params</span>。</span><br><span class="line">路由添加props属性</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;detail&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/about/message/detail/:id&#x27;</span>, <span class="comment">// 动态路由</span></span><br><span class="line">            <span class="attr">component</span>:<span class="title class_">MessageDetail</span>,</span><br><span class="line">            <span class="comment">// 内部自动将接收的params参数以标签属性传入路由组件</span></span><br><span class="line">            <span class="comment">// props:true  // 添加props属性</span></span><br><span class="line">            <span class="attr">props</span>: <span class="function">(<span class="params">route</span>) =&gt;</span> (&#123;<span class="attr">id</span>:route.<span class="property">params</span>.<span class="property">id</span>,<span class="attr">name</span>:route.<span class="property">query</span>.<span class="property">name</span>&#125;) <span class="comment">//props属性支持函数</span></span><br><span class="line">          &#125;</span><br><span class="line">组件种获取props方式传递的参数</span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="built_in">number</span>,</span><br><span class="line">        <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">params参数传递:</span><br><span class="line">&lt;router-link :to=&quot;`/about/message/detail/$&#123;m.id&#125;`&quot;&gt;Message&lt;/router-link&gt;</span><br><span class="line">&lt;router-link :to=&quot;&#123;name: &#x27;detail&#x27;, params: &#123;id: m.id&#125;&#125;&quot;&gt;Message&lt;/router-link&gt;</span><br><span class="line">params参数接收:</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">const route = useRoute() // 路由信息对象</span><br><span class="line">const id = route.params.id</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">通过route.params.id就能获取到传递的id</span><br></pre></td></tr></table></figure>

<h3 id="7-vue-router4禁止路由复用和404"><a href="#7-vue-router4禁止路由复用和404" class="headerlink" title="7. vue-router4禁止路由复用和404"></a>7. vue-router4禁止路由复用和404</h3><p>有时候用户可能输入一个根本不存在的路劲(例如：<code>http://localhost:3000/xxx</code>)，此时最好是给显示个默认的404页面，这样是为了提升用户体验。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意，这个<span class="number">404</span>的路由一定要放在最后，否则容易出现问题</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/:pathMatch(.*)*&#x27;</span>,<span class="comment">//pathMatch可以随便起啥名</span></span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;NotFound&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="keyword">import</span>(<span class="string">&#x27;@/pages/404.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">404.</span>vue中</span><br><span class="line">随便写内容</span><br></pre></td></tr></table></figure>



<h3 id="8-vue-router4案例"><a href="#8-vue-router4案例" class="headerlink" title="8. vue-router4案例"></a>8. vue-router4案例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public中css目录中的bootstrap.css文件</span><br><span class="line">配置index.html</span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.router-link-active</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#d43c33</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#02a774</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>路由配置代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="property">ts</span>中</span><br><span class="line"><span class="comment">// createRouter---创建路由对象</span></span><br><span class="line"><span class="comment">// createWebHistory ----history模式--h5</span></span><br><span class="line"><span class="comment">// createWebHashHistory---hast模式</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">// 引入路由数组</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span></span><br><span class="line"><span class="comment">// 创建路由器对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="comment">// history: createWebHashHistory(), // 模式</span></span><br><span class="line">  <span class="attr">history</span>:<span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes, <span class="comment">// 路由</span></span><br><span class="line">  <span class="comment">// 设置滚动到左侧的顶部</span></span><br><span class="line">  <span class="title function_">scrollBehavior</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">top</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 暴露出去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br><span class="line">routes.<span class="property">ts</span>中</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouteRecordRaw</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">// 静态引入, 没有懒加载</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">News</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/News.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Message</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/Message.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageDetail</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/MessageDetail.vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;@/pages/Home.vue&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">About</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;@/pages/About.vue&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">RouteRecordRaw</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;, &#123; <span class="comment">// 重定向</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;news&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/about/news&#x27;</span>,</span><br><span class="line">        <span class="comment">// component: () =&gt; import(&#x27;@/pages/News.vue&#x27;)</span></span><br><span class="line">        <span class="attr">component</span>:<span class="title class_">News</span></span><br><span class="line">        </span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;message&#x27;</span>, <span class="comment">// path: &#x27;/about/message&#x27;</span></span><br><span class="line">        <span class="comment">// component: () =&gt; import(&#x27;@/pages/Message.vue&#x27;),</span></span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Message</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;detail&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/about/message/detail/:id&#x27;</span>, <span class="comment">// 动态路由</span></span><br><span class="line">            <span class="comment">// component: () =&gt; import(&#x27;@/pages/MessageDetail.vue&#x27;),</span></span><br><span class="line">            <span class="attr">component</span>:<span class="title class_">MessageDetail</span>,</span><br><span class="line">            <span class="comment">// 内部自动将接收的params参数以标签属性传入路由组件</span></span><br><span class="line">            <span class="comment">// props 函数写法</span></span><br><span class="line">            <span class="comment">// props:true</span></span><br><span class="line">            <span class="attr">props</span>: <span class="function">(<span class="params">route</span>) =&gt;</span> (&#123;<span class="attr">id</span>:route.<span class="property">params</span>.<span class="property">id</span>,<span class="attr">name</span>:route.<span class="property">query</span>.<span class="property">name</span>&#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// path:&#x27;/about&#x27;</span></span><br><span class="line">        <span class="attr">redirect</span>:<span class="string">&#x27;/about/news&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> routes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>各个组件种代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">App.vue中进行配置</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;col-xs-offset-2 col-xs-8&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">          &lt;h2&gt;Router Basic&lt;/h2&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;col-xs-2 col-xs-offset-2&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;list-group&quot;&gt;</span><br><span class="line">          &lt;!-- 路由链接 --&gt;</span><br><span class="line">          &lt;!--&lt;router-link to=&quot;路径&quot; class=&quot;list-group-item&quot;&gt;About&lt;/router-link&gt;--&gt;</span><br><span class="line">          &lt;!--&lt;router-link to=&quot;路径&quot; class=&quot;list-group-item&quot;&gt;Home&lt;/router-link&gt;--&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;col-xs-6&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;panel&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;panel-body&quot;&gt;</span><br><span class="line">            &lt;!--路由视图--&gt;</span><br><span class="line">            &lt;!--&lt;router-view /&gt;--&gt;</span><br><span class="line">            &lt;!-- &lt;router-view v-slot=&quot;&#123;Component&#125;&quot;&gt;</span><br><span class="line">		    Vue Router4 的转场动画的实现 和 以前的版本有些不一致。需要将transition 包含在router-view， 如下所示：</span><br><span class="line">              &lt;transition&gt;</span><br><span class="line">                &lt;keep-alive&gt;</span><br><span class="line">                  &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">                &lt;/keep-alive&gt;</span><br><span class="line">              &lt;/transition&gt;</span><br><span class="line">            &lt;/router-view&gt; --&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">Home.vue中</span><br><span class="line"></span><br><span class="line">    &lt;template&gt;</span><br><span class="line">      &lt;h3&gt;Home页面&lt;/h3&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">        export default &#123;</span><br><span class="line">          name: &#x27;Home&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;script lang=&quot;ts&quot; setup&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">About.vue中</span><br><span class="line"></span><br><span class="line">    &lt;template&gt;</span><br><span class="line">      &lt;h3&gt;About页面&lt;/h3&gt;</span><br><span class="line">      &lt;ul class=&quot;nav nav-tabs&quot;&gt;</span><br><span class="line">        &lt;li&gt;&lt;router-link :to=&quot;&#123;name:&#x27;news&#x27;&#125;&quot;&gt;News&lt;/router-link&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;router-link to=&quot;/about/message&quot;&gt;Message&lt;/router-link&gt;&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">      export default &#123;</span><br><span class="line">        name:&#x27;About&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;script lang=&quot;ts&quot; setup&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">Message.vue中</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--message数据列表--&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(m,index) in messages&quot; :key=&quot;m.id&quot;&gt;</span><br><span class="line">        &lt;!-- &lt;router-link :to=&quot;`/about/message/detail/$&#123;m.id&#125;`&quot;&gt;&#123;&#123;m.title&#125;&#125;&lt;/router-link&gt; --&gt;</span><br><span class="line">        &lt;router-link :to=&quot;&#123;name: &#x27;detail&#x27;, params: &#123;id: m.id&#125;&#125;&quot;&gt;&#123;&#123;m.title&#125;&#125;&lt;/router-link&gt;</span><br><span class="line">        -- &lt;button @click=&quot;pushShow(m.id)&quot;&gt;push查看&lt;/button&gt;</span><br><span class="line">        -- &lt;button @click=&quot;replaceShow(m.id)&quot;&gt;replace查看&lt;/button&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;button @click=&quot;$router.back()&quot;&gt;返回&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;$router.forward()&quot;&gt;前进&lt;/button&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Message&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">    // 引入页面加载的钩子和ref</span><br><span class="line">    import &#123; onMounted, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">    // 引入路由器对象</span><br><span class="line">    import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">    // 定义接口，限制对象的数据类型</span><br><span class="line">    interface Message &#123;</span><br><span class="line">      id: number</span><br><span class="line">      title: string</span><br><span class="line">    &#125;</span><br><span class="line">    // 定义数据</span><br><span class="line">    const messages = ref&lt;Message[]&gt;([])</span><br><span class="line">    // 页面加载完毕后的钩子</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        const data: Message[] = [</span><br><span class="line">          &#123; id: 1, title: &#x27;message001&#x27; &#125;,</span><br><span class="line">          &#123; id: 2, title: &#x27;message002&#x27; &#125;,</span><br><span class="line">          &#123; id: 3, title: &#x27;message003&#x27; &#125;</span><br><span class="line">        ]</span><br><span class="line">        messages.value = data</span><br><span class="line">      &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">    // 获取路由器对象</span><br><span class="line">    const router = useRouter()</span><br><span class="line">    const pushShow = (id: number) =&gt; &#123;</span><br><span class="line">      // router.push(&#123; name: &#x27;detail&#x27;, params: &#123; id &#125; &#125;)</span><br><span class="line">      router.push(`/about/message/detail/$&#123;id&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">    const replaceShow = (id: number) =&gt; &#123;</span><br><span class="line">      router.replace(`/about/message/detail/$&#123;id&#125;`)</span><br><span class="line">      // router.replace(&#123; name: &#x27;detail&#x27;, params: &#123; id &#125; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">MessageDetail.vue中</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li&gt;ID:&#123;&#123;$route.params.id&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;Title:&#123;&#123;state.detail.title&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;Content:&#123;&#123;state.detail.content&#125;&#125;&lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      name: &#x27;MessageDetail&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">    import &#123; onMounted, reactive,watch &#125; from &#x27;vue&#x27;</span><br><span class="line">    import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">    // 定义接口</span><br><span class="line">    interface MessageDetail &#123;</span><br><span class="line">      id: number</span><br><span class="line">      title: string</span><br><span class="line">      content: string</span><br><span class="line">    &#125;</span><br><span class="line">    // 定义数据</span><br><span class="line">    const messageDetails: MessageDetail[] = [</span><br><span class="line">      &#123; id: 1, title: &#x27;message001&#x27;, content: &#x27;content001&#x27; &#125;,</span><br><span class="line">      &#123; id: 2, title: &#x27;message002&#x27;, content: &#x27;content002&#x27; &#125;,</span><br><span class="line">      &#123; id: 3, title: &#x27;message003&#x27;, content: &#x27;content003&#x27; &#125;</span><br><span class="line">    ]</span><br><span class="line">    // 定义state对象数据,内部的detail是个对象</span><br><span class="line">    const state = reactive&lt;&#123; detail: MessageDetail &#125;&gt;(&#123;</span><br><span class="line">      detail: &#123;&#125; as MessageDetail</span><br><span class="line">    &#125;)</span><br><span class="line">    // 或者</span><br><span class="line">   // const state = reactive(&#123;</span><br><span class="line">   //   detail:&#123;&#125; as MessageDetail</span><br><span class="line">   // &#125;)</span><br><span class="line">    // 获取路由信息对象</span><br><span class="line">    const route = useRoute()</span><br><span class="line">    // 页面加载完毕后的钩子</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        const id = +route.params.id // 转数字类型</span><br><span class="line">        // 根据id查找对应的对象数据</span><br><span class="line">        // state.detail = messageDetails.find((detail) =&gt; detail.id === id)</span><br><span class="line">      &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 监视params</span><br><span class="line">    watch(()=&gt;route.params,(newParams)=&gt;&#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        const id = +newParams.id</span><br><span class="line">         state.detail = messageDetails.find((detail) =&gt; detail.id === id)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>





<h2 id="Pinia的使用"><a href="#Pinia的使用" class="headerlink" title="Pinia的使用"></a>Pinia的使用</h2><p><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/img/pinia.jpg" alt="Pinia"></p>
<h3 id="1-了解Pinia相关信息"><a href="#1-了解Pinia相关信息" class="headerlink" title="1. 了解Pinia相关信息"></a>1. 了解Pinia相关信息</h3><ul>
<li>Pinia [最初是在 2019 年 11 月左右重新设计使用]。从那时起，最初的原则仍然相同，但 Pinia 对 Vue 2 和 Vue 3 都有效，并且不需要您使用组合 API。</li>
<li>类型安全，通过类型推断，可以提供自动完成的功能。</li>
<li>Pinia 支持扩展，可以非常方便地通过本地存储，事物等进行扩展，模块化设计，通过构建多个存储模块，可以让程序自动拆分它们。</li>
<li>去除 mutations，只有 state，getters，actions，actions 支持同步和异步；<br>代码扁平化没有模块嵌套，只有 store 的概念，store 之间可以自由使用，每一个store都是独立的，无需手动添加 store，store 一旦创建便会自动添加；</li>
</ul>
<h3 id="2-为什么要使用-Pinia"><a href="#2-为什么要使用-Pinia" class="headerlink" title="2. 为什么要使用 Pinia"></a>2. 为什么要使用 Pinia</h3><p>Pinia 是 Vue 的存储库，它允许您跨组件&#x2F;页面共享状态。 如果您熟悉 Composition API，您可能会认为您已经可以通过一个简单的 <code>export const state = reactive(&#123;&#125;)</code>. 这对于单页应用程序来说是正确的，但如果它是服务器端呈现的，<strong>会使您的应用程序暴露于安全漏洞</strong>。 但即使在小型单页应用程序中，您也可以从使用 Pinia 中获得很多好处：</p>
<ul>
<li>dev-tools 支持<ul>
<li>跟踪动作、突变的时间线</li>
<li>Store 出现在使用它们的组件中</li>
<li>time travel 和 更容易的调试</li>
</ul>
</li>
<li>热模块更换<ul>
<li>在不重新加载页面的情况下修改您的 Store</li>
<li>在开发时保持任何现有状态</li>
</ul>
</li>
<li>服务器端渲染支持，完整的 ts 的支持。简便，轻巧，只有大约 1kb 的大小。</li>
</ul>
<h3 id="3-安装和使用Pinia"><a href="#3-安装和使用Pinia" class="headerlink" title="3. 安装和使用Pinia"></a>3. 安装和使用Pinia</h3><p>下面是Vue 3中的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yarn add pinia</span><br><span class="line"># 或者使用 npm</span><br><span class="line">npm install pinia</span><br><span class="line"></span><br><span class="line">main.<span class="property">ts</span>中</span><br><span class="line"><span class="keyword">import</span> &#123;createPinia&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createPinia</span>()</span><br><span class="line">app.<span class="title function_">use</span>(store)</span><br></pre></td></tr></table></figure>

<p>提示:</p>
<p>如果您的应用使用 Vue 2，您还需要安装组合 API：<code>@vue/composition-api</code>。 </p>
<p>如果您使用的是 Vue 2，您还需要安装一个插件并将创建的 <code>pinia</code> 注入应用程序的根目录：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia, <span class="title class_">PiniaVuePlugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">PiniaVuePlugin</span>)</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="comment">// 其他选项...</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 注意同一个 `pinia` 实例可以在多个 Vue 应用程序中使用</span></span><br><span class="line">  <span class="comment">// 同一个页面</span></span><br><span class="line">  pinia,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这也将添加 devtools 支持。在 Vue 3 中，仍然不支持时间旅行和编辑等一些功能，因为 vue-devtools 尚未公开必要的 API，但 devtools 具有更多功能，并且整体开发人员体验要好得多。在 Vue 2 中，Pinia 使用 Vuex 的现有接口（因此不能与它一起使用）。</p>
<h3 id="4-与-Vite中使用Pinia"><a href="#4-与-Vite中使用Pinia" class="headerlink" title="4. 与 Vite中使用Pinia"></a>4. 与 Vite中使用Pinia</h3><ul>
<li>案例1:</li>
<li>pinia的基本使用</li>
<li>vue组件中解构后的数据属于非响应式数据,使用storeToRefs</li>
<li>vue组件中如何修改store中的状态数据:countStore.count,如何修改:countStore.increment</li>
</ul>
<blockquote>
<p>pinia中有 state、actions、getters</p>
<ul>
<li><code>state</code>: 管理数据:state右侧是函数，返回一个对象对象里即为仓库里的数据 </li>
<li><code>actions</code>: 处理同步|异步语句|书写业务逻辑|修改state数据</li>
<li><code>getters</code>: 计算属性：简化数据</li>
</ul>
</blockquote>
<p>注意：</p>
<ul>
<li><p>创建的小仓库，使用函数 <code>defineStore</code>,且名称 一般使用<code>use</code> 开头</p>
</li>
<li><p>Pinia store 依靠 <code>pinia</code> 实例在所有调用中共享同一个 store 实例。 大多数情况下，只需调用您的“useStore()”(小仓库的名称)函数即可开箱即用</p>
</li>
<li><p>必须要在pinia的实例创建完成，才可以在每个组件中使用useStore()，否则需要将pinia实例重新注入useStore中才能正常使用！！！例如：在<font color="red"><strong>路由的前置守卫中使用</strong></font>：</p>
<ul>
<li><pre><code class="js">const pinia = createPinia()
const app = createApp(App)
app.use(router)
app.use(pinia)
router.beforeEach((to) =&gt; &#123;
  // ✅ 这将确保正确的仓库用于当前运行的应用，重新注入pinia的实例
  const main = useMainStore(pinia)

  if (to.meta.requiresAuth &amp;&amp; !main.isLoggedIn) return &#39;/login&#39;
&#125;)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```ts</span><br><span class="line">store目录下index.ts</span><br><span class="line"></span><br><span class="line">// 引入创建pinia的createPiniaAPI</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line">// 创建store对象</span><br><span class="line">const store = createPinia()</span><br><span class="line">// 暴露出去</span><br><span class="line">export default store</span><br><span class="line"></span><br><span class="line">main.ts文件中:</span><br><span class="line"></span><br><span class="line">// 引入createApp</span><br><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">// 引入App组件</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">// 引入store</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line">// 创建app实例</span><br><span class="line">const app = createApp(App)</span><br><span class="line">// 使用store并挂载</span><br><span class="line">app.use(store).mount(&#x27;#app&#x27;)</span><br><span class="line"></span><br><span class="line">store目录下counter.ts</span><br><span class="line"></span><br><span class="line">// 引入定义store的defineStore</span><br><span class="line">import &#123; defineStore &#125; from &#x27;pinia&#x27;</span><br><span class="line">export const useCountStore = defineStore(&#x27;counter&#x27;, &#123;</span><br><span class="line">  // 定义状态数据</span><br><span class="line">  state: () =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    // 加的操作</span><br><span class="line">    increment(num: number) &#123;</span><br><span class="line">      this.count+=num</span><br><span class="line">    &#125;,</span><br><span class="line">    // 减的操作</span><br><span class="line">    decrement(num: number) &#123;</span><br><span class="line">      this.count-=num</span><br><span class="line">    &#125;,</span><br><span class="line">    // 奇数的加</span><br><span class="line">    incrementIfOdd(num: number) &#123;</span><br><span class="line">      if (this.count % 2 !== 0) &#123;</span><br><span class="line">        this.increment(num)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 异步的加</span><br><span class="line">    incrementAsync(num: number) &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.increment(num)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 计算属性</span><br><span class="line">  getters: &#123;</span><br><span class="line">    // 奇偶结果</span><br><span class="line">    evenOrOdd(): string &#123;</span><br><span class="line">      return this.count % 2 === 0 ? &#x27;偶数&#x27; : &#x27;奇数&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    //箭头函数形式，不能使用this</span><br><span class="line">    newCount: (state): number =&gt; &#123; </span><br><span class="line">      return state.count+2</span><br><span class="line">    &#125;,</span><br><span class="line">    // 使用state和this</span><br><span class="line">    getDoubleCount(state): number &#123;</span><br><span class="line">      return state.count * 2 + this.newCount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">CounterShow.vue组件种</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h3&gt;Pinia案例&lt;/h3&gt;</span><br><span class="line">  &lt;!--正确书写方式1:--&gt;</span><br><span class="line">  &lt;h4&gt;count: &#123;&#123;countStore.count&#125;&#125;, count是: &#123;&#123;countStore.evenOrOdd&#125;&#125;&lt;/h4&gt;</span><br><span class="line">  &lt;!--正确书写方式2:--&gt;</span><br><span class="line">  &lt;h4&gt;count: &#123;&#123;count&#125;&#125;, count是: &#123;&#123;evenOrOdd&#125;&#125;&lt;/h4&gt;</span><br><span class="line">  &lt;button @click=&quot;countStore.increment(1)&quot;&gt;increment操作---加&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;countStore.decrement(1)&quot;&gt;decrement操作---减&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;countStore.incrementIfOdd(1)&quot;&gt;incrementiffOdd操作---奇数加&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;countStore.incrementAsync(2)&quot;&gt;incrementAsync操作---异步加&lt;/button&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  &lt;h4&gt;计算属性结果:&#123;&#123;newCount&#125;&#125;&lt;/h4&gt;</span><br><span class="line">  &lt;h4&gt;计算属性结果:&#123;&#123;getDoubleCount&#125;&#125;&lt;/h4&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; mapState &#125; from &#x27;pinia&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CounterShow&#x27;,</span><br><span class="line">  // 不使用setup的写法:</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 计算属性可疑从useCountStore中获取到</span><br><span class="line">    ...mapState(useCountStore, [&#x27;newCount&#x27;])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; useCountStore &#125; from &#x27;../../store/counter&#x27;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;</span><br><span class="line">// 获取countStore对象</span><br><span class="line">const countStore = useCountStore()</span><br><span class="line">// 解构,而且是响应式</span><br><span class="line">const &#123; count, evenOrOdd,getDoubleCount &#125; = storeToRefs(countStore)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>



<p>案例2:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;user&#x27;</span>, <span class="comment">// id配置,唯一性</span></span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小甜甜&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>:<span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 获取年龄</span></span><br><span class="line">    <span class="attr">getAge</span>: (state):<span class="function"><span class="params">number</span> =&gt;</span> &#123; </span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">age</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">UserShow.vue组件种</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h3&gt;user:&#123;&#123;userStore.name&#125;&#125;----&#123;&#123;userStore.age&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  &lt;button @click=&quot;userStore.name+=&#x27;====&#x27;&quot;&gt;直接修改&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;updateUser1&quot;&gt;批量修改:对象方式&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;updateUser2&quot;&gt;批量修改:函数方式&lt;/button&gt;</span><br><span class="line">  &lt;button @click=&quot;updateUser3&quot;&gt;批量修改:替换方式&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;UserShow&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;../../store/user&#x27;</span><br><span class="line">const userStore = useUserStore()</span><br><span class="line">// 批量修改:对象的方式</span><br><span class="line">const updateUser1 = () =&gt; &#123;</span><br><span class="line">  userStore.$patch(&#123;</span><br><span class="line">    name: &#x27;小强&#x27;,</span><br><span class="line">    age: 20</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 批量修改:函数的方式</span><br><span class="line">const updateUser2 = () =&gt; &#123;</span><br><span class="line">  userStore.$patch((state) =&gt; &#123;</span><br><span class="line">    state.name = &#x27;小美&#x27;</span><br><span class="line">    state.age = 30</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 批量修改:替换的方式</span><br><span class="line">const updateUser3 = () =&gt; &#123;</span><br><span class="line">  userStore.$state = &#123;</span><br><span class="line">    name: &#x27;大美丽&#x27;,</span><br><span class="line">    age: 33</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>自己尝试:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">即使您不使用组合 API，也可以使用 Pinia（如果您使用的是 Vue 2，您仍然需要安装@vue/composition-api插件）</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; mapStores,mapStores &#125; from &#x27;pinia&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 获取所有的store</span><br><span class="line">    ...mapStores(useCountStore, useUserStore),</span><br><span class="line">    &#125;),</span><br><span class="line">    // 获取某个store中的count数据</span><br><span class="line">    ...mapWritableState(useCountStore, [&#x27;count&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">     getUserName() &#123;</span><br><span class="line">      console.log(this.userStore.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">pinia异步请求操作案例:</span><br><span class="line"></span><br><span class="line">store/trademark.<span class="property">ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入创建store的函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Trademark</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">tmName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">logoUrl</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义品牌列表接口数组类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">TrademarkList</span> = <span class="title class_">Trademark</span>[]</span><br><span class="line"><span class="comment">// 定义品牌的store并暴露出去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTrademarkStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;trademarker&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">trademarkList</span>: [] <span class="keyword">as</span> <span class="title class_">TrademarkList</span>,</span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getTrademarkList</span>(<span class="params">page: <span class="built_in">number</span>, limit: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> url = <span class="string">`/app-dev/admin/product/baseTrademark/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span></span><br><span class="line">      <span class="comment">// 发送请求</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url)</span><br><span class="line">      <span class="keyword">const</span> &#123; records, total &#125; = result.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">      <span class="comment">// 存储数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">trademarkList</span> = records</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">total</span> = total</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Trademark.vue中</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h3&gt;品牌列表数据&lt;/h3&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;(tm,index) in trademarkStore.trademarkList.splice(3,10)&quot; :key=&quot;tm.id&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123;tm.tmName&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;img :src=&quot;tm.logoUrl&quot; alt=&quot;&quot; width=&quot;100&quot; height=&quot;100&quot; /&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;h3&gt;总数:&#123;&#123;trademarkStore.total&#125;&#125;&lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Trademark&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; useTrademarkStore &#125; from &#x27;../store/trademark&#x27;</span><br><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">const trademarkStore = useTrademarkStore()</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  trademarkStore.getTrademarkList(1, 10)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>







<h3 id="4-与-Vuex-3-x-x2F-4-x相比较"><a href="#4-与-Vuex-3-x-x2F-4-x相比较" class="headerlink" title="4. 与 Vuex 3.x&#x2F;4.x相比较"></a>4. 与 Vuex 3.x&#x2F;4.x相比较</h3><p>Vuex 3.x 是 Vuex 的 Vue 2 而 Vuex 4.x 是 Vue 3</p>
<ul>
<li><em>mutations</em> 不再存在。他们经常被认为是 <strong>非常 冗长</strong>。他们最初带来了 devtools 集成，但这不再是问题。</li>
<li>无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。</li>
<li>不再需要注入、导入函数、调用函数、享受自动完成功能！</li>
<li>无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。</li>
<li>不再有 <em>modules</em> 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 <em>使用</em> 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 <strong>您甚至可以拥有 Store 的循环依赖关系</strong>。</li>
<li>没有 <em>命名空间模块</em>。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。</li>
</ul>
<h2 id="Vue组件通信方式"><a href="#Vue组件通信方式" class="headerlink" title="Vue组件通信方式"></a>Vue组件通信方式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1) props</span><br><span class="line">2) vue自定义事件</span><br><span class="line">3) 全局事件总线</span><br><span class="line">4) v-model</span><br><span class="line">5) .sync</span><br><span class="line">6) $attrs与$listeners</span><br><span class="line">7) $ref </span><br><span class="line">8) $children &amp; $parent</span><br><span class="line">9) provide与inject</span><br><span class="line">10) slot</span><br><span class="line">11) vuex</span><br><span class="line">12) pinia</span><br><span class="line">13) pubsub</span><br></pre></td></tr></table></figure>

<h3 id="1-props"><a href="#1-props" class="headerlink" title="1. props"></a>1. props</h3><p>1). 实现父向子通信: 属性值是非函数<br>2). 实现子向父通信: 属性值是函数<br>应用: 最基本, 用得最多的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">PropsTest组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信1: props&lt;/h1&gt;</span><br><span class="line">    &lt;h3&gt;count:&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;updateCount(10)&quot;&gt;更新数据&lt;/button&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;Child :count=&quot;count&quot; :updateCount=&quot;updateCount&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;PropsTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">import Child from &#x27;./Child.vue&#x27;</span><br><span class="line">const count = ref(0)</span><br><span class="line">const updateCount=(num: number)=&gt;&#123;</span><br><span class="line">  count.value+=num</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Child组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Child component&lt;/h2&gt;</span><br><span class="line">    &lt;h3&gt;count:&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;updateCount(20)&quot;&gt;更新数据&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">// 定义接口,限制接收数据的类型</span><br><span class="line">interface Props&#123;</span><br><span class="line">  count:number</span><br><span class="line">  updateCount(val: number):void</span><br><span class="line">&#125;</span><br><span class="line">// 接收数据</span><br><span class="line">defineProps&lt;Props&gt;()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>





<h3 id="2-自定义事件"><a href="#2-自定义事件" class="headerlink" title="2. 自定义事件"></a>2. 自定义事件</h3><p>用来实现子组件向父组件通信</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">EventTest.vue组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">    区别原生事件与自定义事件</span><br><span class="line">      原生事件</span><br><span class="line">        原生标签上绑定 / 组件标签上绑定加.native</span><br><span class="line">        事件名是特定的一些</span><br><span class="line">        事件对象 / $event: 包含事件相关信息的数据对象, 如: pageX/pageY/target/keyCode</span><br><span class="line">      自定义事件</span><br><span class="line">        组件标签上绑定(不加.native)</span><br><span class="line">        事件名是任意名称</span><br><span class="line">        事件对象 / $event: $emit分发时指定的数据, 可以是任意类型, 甚至是undefined</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信2: vue自定义事件&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;原生事件监听&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;showMsg1&quot;&gt;原生事件1&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;showMsg1($event)&quot;&gt;原生事件2&lt;/button&gt;</span><br><span class="line">    &lt;!--vue2.x中需要使用.native修饰--&gt;</span><br><span class="line">    &lt;Event1 @click.native=&quot;showMsg1&quot; /&gt;</span><br><span class="line">    &lt;!--vue3.x中不再需要使用.native修饰--&gt;</span><br><span class="line">    &lt;Event1 @click=&quot;showMsg1&quot; /&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;h2&gt;自定义事件监听&lt;/h2&gt;</span><br><span class="line">    &lt;Event2 @click=&quot;showMsg2&quot; @xxx=&quot;showMsg3&quot; @increment=&quot;increment&quot; /&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;EventTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">// 引入两个子级组件</span><br><span class="line">import Event1 from &#x27;./Event1.vue&#x27;</span><br><span class="line">import Event2 from &#x27;./Event2.vue&#x27;</span><br><span class="line">// 原生事件所用的回调</span><br><span class="line">const showMsg1 = (event: MouseEvent) =&gt; &#123;</span><br><span class="line">  console.log(event)</span><br><span class="line">  console.log((event.target as HTMLElement).innerHTML)</span><br><span class="line">&#125;</span><br><span class="line">// 自定义事件所需回调(showMsg2和showMsg3和increment)</span><br><span class="line">const showMsg2 = (event: string) =&gt; &#123;</span><br><span class="line">  console.log(event)</span><br><span class="line">&#125;</span><br><span class="line">const showMsg3 = (event: object) =&gt; &#123;</span><br><span class="line">  console.log(event)</span><br><span class="line">&#125;</span><br><span class="line">const count = ref(10)</span><br><span class="line">const increment = (num: number) =&gt; &#123;</span><br><span class="line">  count.value += num</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Event1.vue组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;&lt;h2&gt;Event1组件&lt;/h2&gt;&lt;span&gt;其它内容&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;export default &#123;name: &#x27;Event1&#x27;&#125;&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Event2.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Event2组件&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;$emit(&#x27;click&#x27;,&#x27;小甜甜&#x27;)&quot;&gt;分发自定义事件click&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;$emit(&#x27;xxx&#x27;,&#123;name:&#x27;小甜甜&#x27;,age:20&#125;)&quot;&gt;分发自定义事件xxx&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;$emit(&#x27;increment&#x27;,10)&quot;&gt;分发自定义事件increment&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Event1&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">// 直接接收父级组件传递过来的自定义事件</span><br><span class="line">// 不接收，默认也可以执行,会有冒泡效果</span><br><span class="line">// 接收后,默认的点击就没了</span><br><span class="line">// 第一种接收方式</span><br><span class="line">const emit = defineEmits([&#x27;click&#x27;, &#x27;xxx&#x27;, &#x27;increment&#x27;])</span><br><span class="line">// 第二种接收方式</span><br><span class="line">// defineEmits&lt;&#123;</span><br><span class="line">//   (e:&#x27;click&#x27;,val:string):void</span><br><span class="line">//   (e:&#x27;xxx&#x27;,val:object):void</span><br><span class="line">//   (e:&#x27;increment&#x27;,val:number):void</span><br><span class="line">// &#125;&gt;()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>





<h3 id="3-eventBus和PubSub"><a href="#3-eventBus和PubSub" class="headerlink" title="3. eventBus和PubSub"></a>3. eventBus和PubSub</h3><p>Vue3从实例中移除了 $on、$off 和 $once 方法，所以我们如果希望继续使用全局事件总线，要通过第三方的库：<br>Vue3官方有推荐一些库:mitt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">EventBusTest.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信3: 全局事件总线&lt;/h1&gt;</span><br><span class="line">    &lt;Child1 /&gt;</span><br><span class="line">    &lt;Child2 /&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;Child3 /&gt;</span><br><span class="line">    &lt;Child4 /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;EventBusTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Child1 from &#x27;./Child1.vue&#x27;</span><br><span class="line">import Child2 from &#x27;./Child2.vue&#x27;</span><br><span class="line">import Child3 from &#x27;./Child3.vue&#x27;</span><br><span class="line">import Child4 from &#x27;./Child4.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Child1.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Child111 component&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;clickHandler&quot;&gt;给Child2传递数据&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child1&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import emitter from &#x27;./utils/bus&#x27;</span><br><span class="line">// 点击事件的回调</span><br><span class="line">const clickHandler=()=&gt;&#123;</span><br><span class="line">  // 分发时间</span><br><span class="line">  emitter.emit(&#x27;child2Data&#x27;,&#123;name:&#x27;小甜甜&#x27;,age:20&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Child2.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Child222 component&lt;/h2&gt;</span><br><span class="line">    &lt;h3&gt;传过来的数据:&#123;&#123;user.data&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child2&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import emitter from &#x27;./utils/bus&#x27;</span><br><span class="line">import &#123; onBeforeUnmount, reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">interface User &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line">const user = reactive&lt;&#123; data: User &#125;&gt;(&#123;</span><br><span class="line">  data: &#123;&#125; as User</span><br><span class="line">&#125;)</span><br><span class="line">// 绑定事件</span><br><span class="line">emitter.on(&#x27;child2Data&#x27;, (data: User) =&gt; &#123;</span><br><span class="line">  user.data = data</span><br><span class="line">&#125;)</span><br><span class="line">// 组件销毁前</span><br><span class="line">onBeforeUnmount(()=&gt;&#123;</span><br><span class="line">  emitter.off(&#x27;child2Data&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">utils/bus.ts文件</span><br><span class="line"></span><br><span class="line">import mitt from &#x27;mitt&#x27;;</span><br><span class="line">const emitter = mitt()</span><br><span class="line">export default emitter</span><br><span class="line"></span><br><span class="line">emitter.on(&#x27;*&#x27;, (type, e) =&gt; console.log(type, e) ) // 监听全部事件的写法</span><br><span class="line">emitter.all.clear() 清除所有事件的写法</span><br></pre></td></tr></table></figure>

<p>还有很多的方式,可以直接去npm或者github上查找，最后,就像vue的官网上说的这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在绝大多数情况下，不鼓励使用全局的事件总线在组件之间进行通信。虽然在短期内往往是最简单的解决方案，但从长期来看，它维护起来总是令人头疼。根据具体情况来看，有多种事件总线的替代方案：</span><br><span class="line"></span><br><span class="line"><span class="title class_">Prop</span> 和事件应该是父子组件之间沟通的首选。兄弟节点可以通过它们的父节点通信。</span><br><span class="line"><span class="title class_">Provide</span> 和 inject 允许一个组件与它的插槽内容进行通信。这对于总是一起使用的紧密耦合的组件非常有用。</span><br><span class="line">provide/inject 也能够用于组件之间的远距离通信。它可以帮助避免“prop 逐级透传”，即 prop 需要通过许多层级的组件传递下去，但这些组件本身可能并不需要那些 prop。</span><br><span class="line"><span class="title class_">Prop</span> 逐级透传也可以通过重构以使用插槽来避免。如果一个中间组件不需要某些 prop，那么表明它可能存在关注点分离的问题。在该类组件中使用 slot 可以允许父节点直接为它创建内容，因此 prop 可以被直接传递而不需要中间组件的参与。</span><br></pre></td></tr></table></figure>

<p>pubsub-js消息订阅-发布,React和Vue和微信小程序都可以用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Child3.vue组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Child333 component&lt;/h2&gt;</span><br><span class="line">    &lt;h3&gt;msg:&#123;&#123;msg&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child3&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import PubSub from &#x27;pubsub-js&#x27;</span><br><span class="line">import &#123;ref,onMounted,onBeforeUnmount&#125; from &#x27;vue&#x27;</span><br><span class="line">const msg = ref(&#x27;abc&#x27;)</span><br><span class="line">onMounted(()=&gt;&#123; // 组件挂载后</span><br><span class="line">  // 订阅消息</span><br><span class="line">  PubSub.subscribe(&#x27;updateMsg&#x27;,(msgName,data)=&gt;&#123;</span><br><span class="line">    msg.value += data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">onBeforeUnmount(()=&gt;&#123; // 组件销毁前</span><br><span class="line">  PubSub.unsubscribe(&#x27;updateMsg&#x27;) // 取消订阅</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Child4.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Child4 component&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;PubSub.publish(&#x27;updateMsg&#x27;,&#x27;狗蛋&#x27;)&quot;&gt;更新兄弟组件数据&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child4&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import PubSub from &#x27;pubsub-js&#x27;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>





<h3 id="4-v-model"><a href="#4-v-model" class="headerlink" title="4. v-model"></a>4. v-model</h3><p>v-model的本质是input事件+动态value属性,这种方式是在vue2中</p>
<p>vue3中,v-model的本质是动态modelValue+update:modelValue事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">非兼容：用于自定义组件时，v-model prop 和事件默认名称已更改：</span><br><span class="line">prop：value -&gt; modelValue；</span><br><span class="line">事件：input -&gt; <span class="attr">update</span>:modelValue；</span><br><span class="line">非兼容：v-bind 的 .<span class="property">sync</span> 修饰符和组件的 model 选项已移除，可在 v-model 上加一个参数代替；</span><br><span class="line">新增：现在可以在同一个组件上使用多个 v-model 绑定；</span><br><span class="line">新增：现在可以自定义 v-model 修饰符。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">ModelTest.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信4: v-model&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;1. 用在原生标签上&lt;/h2&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">      原生标签上的本质: 动态value属性 + 原生input监听(将输入的最新值保存到属性上)</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;msg1&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg1&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; :value=&quot;msg2&quot; @input=&quot;msg2=($event.target as HTMLInputElement).value&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg2&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;2. 用在组件标签上&lt;/h2&gt;</span><br><span class="line">    &lt;CustomInput title=&quot;消息1&quot; v-model=&quot;msg3&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg3&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;CustomInput title=&quot;消息2&quot; :modelValue=&quot;msg4&quot; @update:modelValue=&quot;msg4=$event&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg4&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;h2&gt;需求: 自定义方式&lt;/h2&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">      组件标签上的本质: 动态value属性 + 自定义input监听(将子组件分发数据保存父组件的属性上)</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;CustomInput2 title=&quot;消息3&quot; v-model:otherProps1=&quot;msg5&quot; v-model:otherProps2=&quot;msg6&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg5&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;msg6&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;ModelTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import CustomInput from &#x27;./CustomInput.vue&#x27;</span><br><span class="line">import CustomInput2 from &#x27;./CustomInput2.vue&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const msg1 = ref(&#x27;abc1&#x27;)</span><br><span class="line">const msg2 = ref(&#x27;abc2&#x27;)</span><br><span class="line">const msg3 = ref(&#x27;abc3&#x27;)</span><br><span class="line">const msg4 = ref(&#x27;abc4&#x27;)</span><br><span class="line">const msg5 = ref(&#x27;abc5&#x27;)</span><br><span class="line">const msg6 = ref(&#x27;abc6&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CustomInput.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;span style=&quot;margin-right: 10px&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; :value=&quot;modelValue&quot; @input=&quot;$emit(&#x27;update:modelValue&#x27;, ($event.target as HTMLInputElement).value)&quot;&gt;&lt;span&gt;&#123;&#123;modelValue&#125;&#125;&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomInput&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">defineProps([&#x27;title&#x27;, &#x27;modelValue&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">CustomInput2.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;span style=&quot;margin-right: 10px&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/span&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;input type=&quot;text&quot; :value=&quot;otherProps1&quot; @input=&quot;$emit(&#x27;update:otherProps1&#x27;,($event.target as HTMLInputElement).value)&quot;&gt;&lt;span&gt;&#123;&#123;otherProps1&#125;&#125;&lt;/span&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;input type=&quot;text&quot; :value=&quot;otherProps2&quot; @input=&quot;$emit(&#x27;update:otherProps2&#x27;,($event.target as HTMLInputElement).value)&quot;&gt;&lt;span&gt;&#123;&#123;otherProps2&#125;&#125;&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomInput&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">defineProps([&#x27;title&#x27;,&#x27;otherProps1&#x27;,&#x27;otherProps2&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="5-sync"><a href="#5-sync" class="headerlink" title="5. .sync"></a>5. .sync</h3><p>v-model可以作为 <code>.sync</code> 修饰符的替代,vue3中.sync干掉了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信5: sync属性修改符,Vue3中已经移除了.sync&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;小明的爸爸现在有&#123;&#123;total&#125;&#125;元&lt;/p&gt;</span><br><span class="line">    &lt;h2&gt;1. 不使用sync修改符&lt;/h2&gt;</span><br><span class="line">    &lt;Child1 :money=&quot;total&quot; @update:money=&quot;total=$event&quot; /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;total&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;h2&gt;2.使用v-model修改符&lt;/h2&gt;</span><br><span class="line">    &lt;Child2 v-model:total=&quot;total&quot;  /&gt;</span><br><span class="line">     &lt;h2&gt;3. 使用sync修改符&lt;/h2&gt;</span><br><span class="line">    &lt;Child3 :money.sync=&quot;total&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;SyncTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import Child1 from &#x27;./Child1.vue&#x27;</span><br><span class="line">import Child2 from &#x27;./Child2.vue&#x27;</span><br><span class="line">import Child3 from &#x27;./Child3.vue&#x27;</span><br><span class="line">const total = ref(1000)</span><br><span class="line">const title = ref(10000)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Child1.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;span&gt;小明每次花100元&lt;/span&gt;</span><br><span class="line">    &lt;button @click=&quot;spendMoney(100)&quot;&gt;花钱&lt;/button&gt;</span><br><span class="line">    爸爸还剩  &#123;&#123;money&#125;&#125;元</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child2&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">interface Props&#123;</span><br><span class="line">  money:number</span><br><span class="line">&#125;</span><br><span class="line">// 接收父级组件传递进来的数据</span><br><span class="line">const props = defineProps&lt;Props&gt;()</span><br><span class="line">// 获取分发事件的对象</span><br><span class="line">const emit = defineEmits([&#x27;update:money&#x27;])</span><br><span class="line">// 点击的回调</span><br><span class="line">const spendMoney=(count:number)=&gt;&#123;</span><br><span class="line">  emit(&#x27;update:money&#x27;,props.money-count)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Child2.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;span&gt;小明每次花200元&lt;/span&gt;</span><br><span class="line">    &lt;button @click=&quot;$emit(&#x27;update:total&#x27;,total-200)&quot;&gt;花爸爸的钱&lt;/button&gt;</span><br><span class="line">    , 爸爸还剩&#123;&#123;total&#125;&#125; 元</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;Child2&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">// 接收属性</span><br><span class="line">defineProps([&#x27;total&#x27;])</span><br><span class="line">// 接收事件</span><br><span class="line">defineEmits([&#x27;update:total&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Child3.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=&quot;background: #ccc; height: 50px;&quot;&gt;</span><br><span class="line">    &lt;span&gt;小明每次花100元&lt;/span&gt;</span><br><span class="line">    &lt;button @click=&quot;spendMoney(100)&quot;&gt;花钱&lt;/button&gt;</span><br><span class="line">    爸爸还剩 &#123;&#123;money&#125;&#125; 元</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/ecmascript-6&quot;&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#x27;Child&#x27;,</span><br><span class="line">    props: [&#x27;money&#x27;],</span><br><span class="line">    methods: &#123;</span><br><span class="line">      spendMoney (count) &#123;</span><br><span class="line">        console.log(&#x27;测试&#x27;)</span><br><span class="line">        this.$emit(&#x27;update:money&#x27;, this.money - count)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<h3 id="6-attrs-amp-listeners"><a href="#6-attrs-amp-listeners" class="headerlink" title="6. $attrs&amp;$listeners"></a>6. $attrs&amp;$listeners</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>). $attrs</span><br><span class="line">    实现当前组件的父组件向当前组件的子组件通信</span><br><span class="line">    它是包含所有父组件传入的标签属性(排除props声明, <span class="keyword">class</span>与style的属性)的对象</span><br><span class="line">    使用: 通过 v-bind=<span class="string">&quot;$attrs&quot;</span> 将父组件传入的n个属性数据传递给当前组件的子组件</span><br><span class="line"><span class="number">2</span>). $listeners</span><br><span class="line">    实现当前组件的子组件向当前组件的父组件通信</span><br><span class="line">    $listeners是包含所有父组件传入的自定义事件监听名与对应回调函数的对象</span><br><span class="line">    使用: 通过v-on=<span class="string">&quot;$listeners&quot;</span> 将父组件绑定给当前组件的事件监听绑定给当前组件的子组件</span><br><span class="line">应用: 利用它封装了一个自定义的带hover文本提示的el-button</span><br></pre></td></tr></table></figure>



<p>vue3中已经干掉了$listeners</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">AttrsListenersTest.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信6: $attrs与$listeners&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;需求: 自定义带Hover提示的按钮&lt;/h2&gt;</span><br><span class="line">    &lt;!-- &lt;el-button type=&quot;success&quot; size=&quot;small&quot; :icon=&quot;Plus&quot;&gt;按钮&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;warning&quot; size=&quot;default&quot; :icon=&quot;Edit&quot;&gt;按钮&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; size=&quot;large &quot; :icon=&quot;Delete&quot;&gt;按钮&lt;/el-button&gt; --&gt;</span><br><span class="line">    &lt;HintButton title=&quot;增加&quot; type=&quot;success&quot; size=&quot;small&quot; :icon=&quot;Plus&quot; @click=&quot;add&quot; /&gt;</span><br><span class="line">    &lt;HintButton title=&quot;修改&quot; type=&quot;warning&quot; size=&quot;default&quot; :icon=&quot;Edit&quot; @click=&quot;update&quot; /&gt;</span><br><span class="line">    &lt;HintButton title=&quot;删除&quot; type=&quot;danger&quot; size=&quot;large &quot; :icon=&quot;Delete&quot; @click=&quot;del&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;AttrsListenersTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;Plus,Edit,Delete&#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import HintButton from &#x27;./HintButton.vue&#x27;</span><br><span class="line">const add=()=&gt;&#123;</span><br><span class="line">  console.log(&#x27;增加&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">const update=()=&gt;&#123;</span><br><span class="line">  console.log(&#x27;修改&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">const del=()=&gt;&#123;</span><br><span class="line">  console.log(&#x27;删除&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">HintButton.vue 组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tooltip  effect=&quot;dark&quot; :content=&quot;title&quot; placement=&quot;top-start&quot;&gt;</span><br><span class="line">    &lt;el-button v-bind=&quot;$attrs&quot;&gt;按钮&lt;/el-button&gt;</span><br><span class="line">  &lt;/el-tooltip&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HintButton&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;useAttrs&#125; from &#x27;vue&#x27;</span><br><span class="line">// 使用props的方式接收传递进来的属性数据</span><br><span class="line">defineProps([&#x27;title&#x27;])</span><br><span class="line">// 获取没有被props接收到的数据</span><br><span class="line">const attrs = useAttrs()</span><br><span class="line">// 输出没有使用props接收的数据和事件</span><br><span class="line">console.log(attrs)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="7-refs-amp-parent-amp-defineExpose"><a href="#7-refs-amp-parent-amp-defineExpose" class="headerlink" title="7. $refs &amp; $parent &amp; defineExpose"></a>7. $refs &amp; $parent &amp; defineExpose</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>). ref</span><br><span class="line">    实现父组件向指定子组件通信</span><br><span class="line">    ref是包含所有有ref属性的标签对象或组件对象的容器对象</span><br><span class="line">    使用: 通过 </span><br><span class="line">    <span class="keyword">const</span> sonRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">Son</span>&gt; | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">    得到子组件对象, 从而可以直接更新其数据或调用其方法更新数据</span><br><span class="line"><span class="number">2</span>). <span class="title function_">defineExpose</span>(&#123; receiveMoney&#125;) 暴露当前组件方法</span><br><span class="line"><span class="number">3</span>). $parent</span><br><span class="line">    实现子组件向父组件通信</span><br><span class="line">    $parent是当前组件的父组件对象</span><br><span class="line">    使用: 通过$parent 得到父组件对象, 从而可以更新父组件的数据</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">RefChildrenParent.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信7: $ref &amp; $children &amp; $parent&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;BABA有存款: &#123;&#123;money&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;borrowMoney1(100)&quot;&gt;找小明借钱100&lt;/button&gt;&lt;br&gt;</span><br><span class="line">    &lt;button @click=&quot;borrowMoney2(150)&quot;&gt;找小红借钱150&lt;/button&gt;&lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;Son ref=&quot;sonRef&quot; /&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;Daughter ref=&quot;dauRef&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;ChildrenParentTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Son from &#x27;./Son.vue&#x27;</span><br><span class="line">import Daughter from &#x27;./Daughter.vue&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const money = ref(1000)</span><br><span class="line">// 获取子级组件</span><br><span class="line">const sonRef = ref&lt;InstanceType&lt;typeof Son&gt; | null&gt;(null)</span><br><span class="line">const dauRef = ref&lt;InstanceType&lt;typeof Daughter&gt; | null&gt;(null)</span><br><span class="line">// 借钱方法1</span><br><span class="line">const borrowMoney1 = (num) =&gt; &#123;</span><br><span class="line">  ;(sonRef.value as any)?.borrowMoney(num)</span><br><span class="line">  money.value += num</span><br><span class="line">&#125;</span><br><span class="line">// 借钱方法2</span><br><span class="line">const borrowMoney2 = (num: number) =&gt; &#123;</span><br><span class="line">  ;(dauRef.value as any)?.borrowMoney(num)</span><br><span class="line">  money.value += num</span><br><span class="line">&#125;</span><br><span class="line">const receiveMoney = (num: number) =&gt; &#123;</span><br><span class="line">  money.value += num</span><br><span class="line">&#125;</span><br><span class="line">// 向外暴露组件内的方法</span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  receiveMoney</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Son.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h3&gt;儿子小明: 有存款: &#123;&#123;money&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;giveMoney(50,$parent)&quot;&gt;给BABA钱: 50&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;Son&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const money = ref(30000)</span><br><span class="line">// 借钱方法</span><br><span class="line">const borrowMoney = (num: number) =&gt; &#123;</span><br><span class="line">  money.value -= num</span><br><span class="line">&#125;</span><br><span class="line">// 给钱方法</span><br><span class="line">const giveMoney = (num: number, parent: any) =&gt; &#123;</span><br><span class="line">  parent.receiveMoney(num)</span><br><span class="line">  money.value -= num</span><br><span class="line">&#125;</span><br><span class="line">// 暴露出去</span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  borrowMoney</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">Daughter.vue组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h3&gt;女儿小红: 有存款: &#123;&#123;money&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;giveMoney(100,$parent)&quot;&gt;给BABA钱: 100&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;defineComponent&#125; from &#x27;vue&#x27;</span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &#x27;Daughter&#x27;</span><br><span class="line">&#125;) </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const money = ref(20000)</span><br><span class="line">// 借钱方法</span><br><span class="line">const borrowMoney = (num: number) =&gt; &#123;</span><br><span class="line">  money.value -= num</span><br><span class="line">&#125;</span><br><span class="line">// 给钱方法</span><br><span class="line">const giveMoney = (num: number, parent: any) =&gt; &#123;</span><br><span class="line">  parent.receiveMoney(num)</span><br><span class="line">  money.value -= num</span><br><span class="line">&#125;</span><br><span class="line">// 暴露出去</span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  borrowMoney</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>





<h3 id="8-provide-inject"><a href="#8-provide-inject" class="headerlink" title="8. provide-inject"></a>8. provide-inject</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>). 实现祖孙组件间直接通信</span><br><span class="line"><span class="number">2</span>). 使用</span><br><span class="line">	在祖组件中通过<span class="title function_">provide</span>(<span class="string">&#x27;xxx&#x27;</span>,数据)配置向后代组件提供数据</span><br><span class="line">	在后代组件中通过<span class="title function_">inject</span>()配置来声明接收数据</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">ProvideInjectTest.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信8: provide + inject&lt;/h1&gt;</span><br><span class="line">    &lt;h3&gt;content1:&#123;&#123;state.content1&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;updateContent(&#x27;==&#x27;)&quot;&gt;更新content1数据&lt;/button&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h3&gt;content2:&#123;&#123;state.content2&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;state.content2=&#123;name:&#x27;大美丽&#x27;,age:30&#125;&quot;&gt;更新content2对象数据&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;state.content2.name+=&#x27;++++&#x27;&quot;&gt;更新content2名字数据&lt;/button&gt;</span><br><span class="line">    &lt;h2&gt;祖组件标题&lt;/h2&gt;</span><br><span class="line">    &lt;Child /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;ProvideInjectTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import Child from &#x27;./Child.vue&#x27;</span><br><span class="line">import &#123; provide, reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  content1: &#x27;abc&#x27;,</span><br><span class="line">  content2: &#123;</span><br><span class="line">    name: &#x27;小甜甜&#x27;,</span><br><span class="line">    age: 20</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">const updateContent = (msg: string) =&gt; &#123;</span><br><span class="line">  state.content1 += msg</span><br><span class="line">&#125;</span><br><span class="line">provide(&#x27;content11&#x27;, state.content1)</span><br><span class="line">provide(&#x27;content22&#x27;, state.content2)</span><br><span class="line">provide(&#x27;updateContent1&#x27;, updateContent)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">GrandChild.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h4&gt;孙组件标题&lt;/h4&gt;</span><br><span class="line">   &lt;h3&gt;content11:&#123;&#123;content11&#125;&#125;&lt;/h3&gt;</span><br><span class="line">   &lt;h3&gt;content22:&#123;&#123;content22&#125;&#125;&lt;/h3&gt;</span><br><span class="line">   &lt;button @click=&quot;updateContent1(&#x27;+++++&#x27;)&quot;&gt;更新父级组件数据&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;GrandChild&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;inject&#125; from &#x27;vue&#x27;</span><br><span class="line">const content11 = inject&lt;string&gt;(&#x27;content11&#x27;)</span><br><span class="line">const content22 = inject&lt;&#123;name:string,age:number&#125;&gt;(&#x27;content22&#x27;)</span><br><span class="line">const updateContent1 =inject&lt;(msg:string)=&gt;void&gt;(&#x27;updateContent1&#x27;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="9-slot"><a href="#9-slot" class="headerlink" title="9. slot"></a>9. slot</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>). 实现父组件向子组件传递标签内容</span><br><span class="line"><span class="number">2</span>). 什么情况下使用作用域插槽?</span><br><span class="line">    父组件需要向子组件传递标签结构内容</span><br><span class="line">    但决定父组件传递怎样标签结构的数据在子组件中</span><br></pre></td></tr></table></figure>

<p>默认插槽：使用时，在组件的对标签中添加结构即可，不需要template</p>
<p>具名插槽</p>
<p>作用域插槽：子组件的数据由父组件提供，子组件的样式由父组件决定</p>
<p><code>v-slot</code> : 简写：<code>#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">types.ts</span><br><span class="line">// 暴露接口</span><br><span class="line">export interface User &#123; </span><br><span class="line">  id: number</span><br><span class="line">  title: string</span><br><span class="line">  isComplete:boolean</span><br><span class="line">&#125;</span><br><span class="line">// 暴露类型Users数组</span><br><span class="line">export type Users=User[]</span><br><span class="line"></span><br><span class="line">SlotTest.vue组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;h1&gt;组件间通信10: 插槽==&gt; 作用域插槽&lt;/h1&gt;</span><br><span class="line">    &lt;h2&gt;需求: 自定义TODO列表组件能实现下面需求&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;效果一: 显示TODO列表时, 已完成的TODO为绿色&lt;/h2&gt;</span><br><span class="line">    &lt;List :todos=&quot;todos&quot;&gt;</span><br><span class="line">      &lt;template v-slot=&quot;&#123;row,$index&#125;&quot;&gt;</span><br><span class="line">        &lt;p :style=&quot;&#123;color:row.isComplete?&#x27;green&#x27;:&#x27;&#x27;&#125;&quot;&gt;id:&#123;&#123;row.id&#125;&#125;--标题:&#123;&#123;row.title&#125;&#125;--索引:&#123;&#123;$index&#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/List&gt;</span><br><span class="line">    &lt;h2&gt;效果二: 显示TODO列表时, 带序号, TODO的颜色为蓝绿搭配&lt;/h2&gt;</span><br><span class="line">      &lt;List :todos=&quot;todos&quot;&gt;</span><br><span class="line">      &lt;template v-slot=&quot;&#123;row,$index&#125;&quot;&gt;</span><br><span class="line">        &lt;p :style=&quot;&#123;color:$index%2==0?&#x27;green&#x27;:&#x27;blue&#x27;&#125;&quot;&gt;序号:&#123;&#123;$index+1&#125;&#125;--标题:&#123;&#123;row.title&#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/List&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;SlotTest&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import List from &#x27;./List.vue&#x27;</span><br><span class="line">import type &#123;Users&#125; from &#x27;./types&#x27;</span><br><span class="line">const todos = ref&lt;Users&gt;([</span><br><span class="line">  &#123;id:1,title:&#x27;AAA&#x27;,isComplete:false&#125;,</span><br><span class="line">  &#123;id:2,title:&#x27;BBB&#x27;,isComplete:true&#125;,</span><br><span class="line">  &#123;id:3,title:&#x27;CCC&#x27;,isComplete:false&#125;,</span><br><span class="line">  &#123;id:4,title:&#x27;DDD&#x27;,isComplete:false&#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">List.vue组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">          子组件需要向父组件传递数据 ==&gt; 作用域插槽</span><br><span class="line">          slot标签的所有属性会自动传递给父组件</span><br><span class="line">         --&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(todo,index) in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">        &lt;slot :row=&quot;todo&quot; :$index=&quot;index&quot; /&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;List&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">// 引入Users数组类型</span><br><span class="line">import type &#123; Users &#125; from &#x27;./types&#x27;</span><br><span class="line">// 定义Props接口</span><br><span class="line">interface Props &#123;</span><br><span class="line">  todos: Users</span><br><span class="line">&#125;</span><br><span class="line">// 接收父级组件传递过来的数据</span><br><span class="line">defineProps&lt;Props&gt;()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>







<h3 id="10-vuex"><a href="#10-vuex" class="headerlink" title="10. vuex"></a>10. vuex</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1). 实现任意组件间通信</span><br><span class="line">2). Vuex 是一个专为 Vue 应用程序设计的管理多组件共享状态数据的 Vue 插件</span><br><span class="line">    任意组件都可以读取到Vuex中store的state对象中的数据</span><br><span class="line">    任意组件都可以通过dispatch()或commit()来触发store去更新state中的数据</span><br><span class="line">    一旦state中的数据发生变化, 依赖于这些数据的组件就会自动更新</span><br><span class="line">应用: 前台和后台项目都有用vuex管理组件数据 </span><br></pre></td></tr></table></figure>



<h3 id="11-pinia"><a href="#11-pinia" class="headerlink" title="11. pinia"></a>11. pinia</h3><h3 id="12-面试题-组件通信方式"><a href="#12-面试题-组件通信方式" class="headerlink" title="12. 面试题:组件通信方式"></a>12. 面试题:组件通信方式</h3><p>组件:具有特定功能效果的集合(html,css,js)—html,css,ts</p>
<p>组件通信:组件和组件之间传递数据,组件和组件的关系:父子关系(直接&#x2F;间接),兄弟关系,任意关系</p>
<p>组件通信方式有哪些:</p>
<p>props—父子组件通信</p>
<p>自定义事件(Custom Event),—父子组件通信</p>
<p>事件总线($bus—vue2.x的语法,原理是:原型)&#x2F;mitt–插件,—任意组件通信</p>
<p>消息订阅与发布(pubsub-js),—任意组件通信, —–React&#x2F;小程序&#x2F;Vue</p>
<p>v-model(.sync-vue2),—父子组件通信 ,本质:Vue2中(value属性+input事件),Vue3中(modelValue+update:modelValue事件)</p>
<p><code>$refs</code>和<code>$parent</code>和<code>$children</code>, ——父子组件通信</p>
<p><code>$attrs</code>和<code>$listeners</code>(vue2中,vue3中没有),—–父子组件通信—高级复用组件—HintButton</p>
<p>provide-inject,—-任意组件通信</p>
<p>slot(默认插槽,具名插槽,作用域插槽),—父子组件通信</p>
<p>vuex,—-任意组件通信(vuex3.x，vuex4.x语法—和pinia很像)</p>
<p>pinia,—-任意组件通信(vue3.x)</p>
<p>组件通信常用的方式有哪些：props,作用域插槽,vuex(pinia),自定义事件,v-model,$attrs</p>
<p>我的项目中用到了哪些,哪一块用到什么方式:pinia,作用域插槽,自定义事件,v-model,$attrs</p>
<p>某些组件通信的原理</p>
<p>扩展:vue中组件通信,使用了很多方式,其实React中也有通信方式,也有组件通信,小程序中有组件通信,页面通信…..</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><h3 id="自定义ref"><a href="#自定义ref" class="headerlink" title="自定义ref"></a>自定义ref</h3><p>作用：创建一个自定义的ref，并对其依赖项进行跟踪和更新触发进行逻辑控制</p>
<p><code>customRef</code></p>
<p>案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; msg &#125;&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=&quot;text&quot; v-model=&quot;msg&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; customRef &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">let initValue = &quot;hello&quot;;</span><br><span class="line">let timer: number;</span><br><span class="line">let msg = customRef((track, trigger) =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    get() &#123;</span><br><span class="line">      track(); // 告诉vue 追踪依赖</span><br><span class="line">      return initValue;</span><br><span class="line">    &#125;,</span><br><span class="line">    set(value) &#123;</span><br><span class="line">      clearTimeout(timer);</span><br><span class="line">      timer = setTimeout(() =&gt; &#123;</span><br><span class="line">        trigger(); // 通知vue 数据变化了</span><br><span class="line">        initValue = value;</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://old-gang.github.io">Mr.储</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://old-gang.github.io/post/bc05aa0f.html">https://old-gang.github.io/post/bc05aa0f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://old-gang.github.io" target="_blank">Mr.储</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web%E5%89%8D%E7%AB%AF/">web前端</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/d04ba932.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Vue的组件通信</div></div></a></div><div class="next-post pull-right"><a href="/post/ac78d05b.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">react路由-v6</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mr.储</div><div class="author-info__description">Fake it, until u make it~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/old-gang"><i class="fab fa-github"></i><span>点个关注呗</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/old-gang" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p align="center"><img src="https://chu-image-host.oss-cn-beijing.aliyuncs.com/typora/f7384c88956d4378b72e47548e19c9f8.gif" width="50" alt="gou"></p> <p align="center">微信号：cr1710518304</p> <p align="center">QQ号：1710518304</p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3-Vue3"><span class="toc-number">1.</span> <span class="toc-text">了解 Vue3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BA%86%E8%A7%A3%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.</span> <span class="toc-text">1. 了解相关信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87"><span class="toc-number">1.2.</span> <span class="toc-text">2. 性能提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Composition-API"><span class="toc-number">1.3.</span> <span class="toc-text">3. Composition API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%85%B6%E5%AE%83%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">4. 其它新增特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAvue3%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">创建vue3项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8-vue-cli-%E5%88%9B%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">1. 使用 vue-cli 创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-vite-%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.</span> <span class="toc-text">2. 使用 vite 创建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E8%AF%86Vue3"><span class="toc-number">3.</span> <span class="toc-text">初识Vue3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">1.源码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Composition-API%E4%BD%BF%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">Composition API使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-setup"><span class="toc-number">4.1.</span> <span class="toc-text">1. setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ref"><span class="toc-number">4.2.</span> <span class="toc-text">2. ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-reactive"><span class="toc-number">4.3.</span> <span class="toc-text">3. reactive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%AF%94%E8%BE%83Vue2%E4%B8%8EVue3%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F-%E9%87%8D%E8%A6%81"><span class="toc-number">4.4.</span> <span class="toc-text">4. 比较Vue2与Vue3的响应式(重要)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Vue2%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E6%A0%B8%E5%BF%83"><span class="toc-number">4.4.1.</span> <span class="toc-text">1) Vue2的响应式核心:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Vue3%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E6%A0%B8%E5%BF%83"><span class="toc-number">4.4.2.</span> <span class="toc-text">2) Vue3的响应式核心:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-setup%E7%BB%86%E8%8A%82"><span class="toc-number">4.5.</span> <span class="toc-text">5. setup细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-reactive%E4%B8%8Eref%E7%BB%86%E8%8A%82"><span class="toc-number">4.6.</span> <span class="toc-text">6. reactive与ref细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E4%B8%8E%E7%9B%91%E8%A7%86"><span class="toc-number">4.7.</span> <span class="toc-text">7. 计算属性与监视</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-toRef"><span class="toc-number">4.8.</span> <span class="toc-text">8. toRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-ref%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0"><span class="toc-number">4.9.</span> <span class="toc-text">9. ref获取元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83-Composition-API"><span class="toc-number">5.</span> <span class="toc-text">其它 Composition API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-shallowReactive-%E4%B8%8E-shallowRef"><span class="toc-number">5.1.</span> <span class="toc-text">1. shallowReactive 与 shallowRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-readonly-%E4%B8%8E-shallowReadonly"><span class="toc-number">5.2.</span> <span class="toc-text">2. readonly 与 shallowReadonly</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-toRaw-%E4%B8%8E-markRaw"><span class="toc-number">5.3.</span> <span class="toc-text">3. toRaw 与 markRaw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-customRef"><span class="toc-number">5.4.</span> <span class="toc-text">4. customRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-provide-%E4%B8%8E-inject"><span class="toc-number">5.5.</span> <span class="toc-text">5. provide 与 inject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">5.6.</span> <span class="toc-text">6. 响应式数据的判断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">新的组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Fragment"><span class="toc-number">6.1.</span> <span class="toc-text">1.Fragment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Teleport"><span class="toc-number">6.2.</span> <span class="toc-text">2.Teleport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Suspense-%E8%BF%98%E4%B8%8D%E7%A8%B3%E5%AE%9A"><span class="toc-number">6.3.</span> <span class="toc-text">3.Suspense(还不稳定)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">7.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%85%A8%E5%B1%80API%E7%9A%84%E8%BD%AC%E7%A7%BB"><span class="toc-number">7.1.</span> <span class="toc-text">1.全局API的转移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B6%E4%BB%96%E6%94%B9%E5%8F%98"><span class="toc-number">7.2.</span> <span class="toc-text">2.其他改变</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.</span> <span class="toc-text">生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-vue2-x%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.1.</span> <span class="toc-text">1. vue2.x的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-vue3%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.2.</span> <span class="toc-text">2. vue3的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%AF%B9%E6%AF%94"><span class="toc-number">8.3.</span> <span class="toc-text">3.生命周期对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89hooks%E5%87%BD%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">自定义hooks函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-compostion-API-VS-Option-API"><span class="toc-number">9.1.</span> <span class="toc-text">1. compostion API   VS Option API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E8%87%AA%E5%AE%9A%E4%B9%89Hook"><span class="toc-number">9.2.</span> <span class="toc-text">理解自定义Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%821"><span class="toc-number">9.3.</span> <span class="toc-text">需求1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%822"><span class="toc-number">9.4.</span> <span class="toc-text">需求2:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E5%BC%BA%E5%8C%96%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="toc-number">9.5.</span> <span class="toc-text">泛型强化类型检查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VueRouter4%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">10.</span> <span class="toc-text">VueRouter4的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BA%86%E8%A7%A3vue-router4%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">10.1.</span> <span class="toc-text">1. 了解vue-router4相关信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85vue-router4"><span class="toc-number">10.2.</span> <span class="toc-text">2. 安装vue-router4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AEvite"><span class="toc-number">10.3.</span> <span class="toc-text">2. 配置vite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-vue-router4router-link%E5%92%8Crouter-view%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E5%A4%9F%E7%9B%B4%E6%8E%A5%E7%94%A8"><span class="toc-number">10.4.</span> <span class="toc-text">3. vue-router4router-link和router-view为什么能够直接用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8vue-router4%E5%8F%8Ahash%E5%92%8Chistory%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.5.</span> <span class="toc-text">4. 使用vue-router4及hash和history模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-vue-router4%E9%80%89%E4%B8%AD%E6%A0%B7%E5%BC%8FlinkActiveClass"><span class="toc-number">10.6.</span> <span class="toc-text">5. vue-router4选中样式linkActiveClass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-vue-router4%E5%8F%82%E6%95%B0-query%E5%92%8Cparams"><span class="toc-number">10.7.</span> <span class="toc-text">6. vue-router4参数(query和params)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-vue-router4%E7%A6%81%E6%AD%A2%E8%B7%AF%E7%94%B1%E5%A4%8D%E7%94%A8%E5%92%8C404"><span class="toc-number">10.8.</span> <span class="toc-text">7. vue-router4禁止路由复用和404</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-vue-router4%E6%A1%88%E4%BE%8B"><span class="toc-number">10.9.</span> <span class="toc-text">8. vue-router4案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">11.</span> <span class="toc-text">Pinia的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BA%86%E8%A7%A3Pinia%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">11.1.</span> <span class="toc-text">1. 了解Pinia相关信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-Pinia"><span class="toc-number">11.2.</span> <span class="toc-text">2. 为什么要使用 Pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8Pinia"><span class="toc-number">11.3.</span> <span class="toc-text">3. 安装和使用Pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8E-Vite%E4%B8%AD%E4%BD%BF%E7%94%A8Pinia"><span class="toc-number">11.4.</span> <span class="toc-text">4. 与 Vite中使用Pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8E-Vuex-3-x-x2F-4-x%E7%9B%B8%E6%AF%94%E8%BE%83"><span class="toc-number">11.5.</span> <span class="toc-text">4. 与 Vuex 3.x&#x2F;4.x相比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">12.</span> <span class="toc-text">Vue组件通信方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-props"><span class="toc-number">12.1.</span> <span class="toc-text">1. props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6"><span class="toc-number">12.2.</span> <span class="toc-text">2. 自定义事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-eventBus%E5%92%8CPubSub"><span class="toc-number">12.3.</span> <span class="toc-text">3. eventBus和PubSub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-v-model"><span class="toc-number">12.4.</span> <span class="toc-text">4. v-model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-sync"><span class="toc-number">12.5.</span> <span class="toc-text">5. .sync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-attrs-amp-listeners"><span class="toc-number">12.6.</span> <span class="toc-text">6. $attrs&amp;$listeners</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-refs-amp-parent-amp-defineExpose"><span class="toc-number">12.7.</span> <span class="toc-text">7. $refs &amp; $parent &amp; defineExpose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-provide-inject"><span class="toc-number">12.8.</span> <span class="toc-text">8. provide-inject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-slot"><span class="toc-number">12.9.</span> <span class="toc-text">9. slot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-vuex"><span class="toc-number">12.10.</span> <span class="toc-text">10. vuex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-pinia"><span class="toc-number">12.11.</span> <span class="toc-text">11. pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E9%9D%A2%E8%AF%95%E9%A2%98-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">12.12.</span> <span class="toc-text">12. 面试题:组件通信方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-number">13.</span> <span class="toc-text">更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89ref"><span class="toc-number">13.1.</span> <span class="toc-text">自定义ref</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Mr.储</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-api-ten-lac.vercel.app',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-api-ten-lac.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>